import{r as i,j as e,B as c,T as l,n as Ie}from"./index-5_xlyy_z.js";import{S as Me}from"./Search-Ca34G4DN.js";import{T as ye,a as ve,b as De,c as _,d,e as Se,C as we,f as Ee,P as Te}from"./CheckBoxOutlineBlank-C4-RMF3j.js";import{M as ke}from"./MoreVert-D5wLa2bW.js";import{A as G,D as Ne,M as p}from"./AdminSidebar-ir24IhBt.js";import{g as Ve,a as Re,c as T,b as We,r as ze}from"./workspaceService-W5-pIJdk.js";import{T as Fe,F as Y,a as J,S as q}from"./TextField-DTeEVDZd.js";import{I as Pe}from"./InputAdornment-ChgL2PRV.js";import{A as I}from"./Alert-DgSVIo8A.js";import{P as Be}from"./Paper-BlKRAiFO.js";import{C as Le}from"./Checkbox-ZZc08eID.js";import{C as k}from"./Chip-CX1Ac_Cc.js";import{T as Oe}from"./Tooltip-D70YOTbh.js";import{I as He}from"./IconButton-gBT5SOuH.js";import{D as U,a as X,b as $,c as K}from"./DialogTitle-Bj6VsLFW.js";import{B as u}from"./Button-D0cPLAFR.js";import"./createSvgIcon-BNamIVrA.js";import"./createSvgIcon-yTDobCCO.js";import"./useControlled-l9-LdqaY.js";import"./Menu-V8Z48i-c.js";import"./resolveComponentProps-DW3eJbQO.js";import"./useMediaQuery-Cnns6WQt.js";import"./getThemeProps-1gZypGI7.js";import"./Divider-BNw4ekCJ.js";import"./Avatar-CgNGEcCC.js";import"./useSlot-D9lDOFSj.js";import"./session-Cma3K_fR.js";import"./SwitchBase-CinLHmWg.js";const js=()=>{const[M,Q]=i.useState(""),[Z,ee]=i.useState([]),[b,se]=i.useState(1),[N]=i.useState(20),[j,te]=i.useState([]),[re,V]=i.useState(!0),[R,o]=i.useState(""),[t,C]=i.useState(null),[ae,A]=i.useState(!1),[a,ie]=i.useState(""),[W,ne]=i.useState(0),[y,le]=i.useState(""),[v,oe]=i.useState(""),[f,m]=i.useState(!1),[z,x]=i.useState(""),[ce,D]=i.useState(!1),[h,S]=i.useState(null),[de,he]=i.useState(!1),me=async()=>{try{V(!0),o("");const s=await Ve();ie(s.id),await g(s.id)}catch(s){o(s instanceof Error?s.message:"Failed to load workspace data")}finally{V(!1)}},g=async(s,r=1)=>{try{const n=await Re(s,{search:M||void 0,status:y||void 0,role:v||void 0,page:r,limit:N});te(n.data),ne(n.pagination.total),se(r)}catch(n){console.error("Error fetching members:",n),o(n instanceof Error?n.message:"Failed to load members")}};i.useEffect(()=>{me()},[]),i.useEffect(()=>{a&&g(a,1)},[M,y,v,a]);const xe=s=>{ee(r=>r.includes(s)?r.filter(n=>n!==s):[...r,s])},ue=s=>{C(s),A(!0)},F=()=>{A(!1),C(null)},fe=async s=>{if(a)try{m(!0),await T(a,s,"ACTIVE"),x("Member activated successfully!"),await g(a,b),A(!1),C(null),setTimeout(()=>x(""),3e3)}catch(r){o(r instanceof Error?r.message:"Failed to activate member")}finally{m(!1)}},ge=async s=>{if(a)try{m(!0),o(""),await T(a,s,"DEACTIVATED"),x("Member deactivated successfully!"),await g(a,b),A(!1),C(null),setTimeout(()=>x(""),3e3)}catch(r){const n=r instanceof Error?r.message:"Failed to deactivate member";o(n),setTimeout(()=>o(""),5e3)}finally{m(!1)}},P=async(s,r)=>{if(a)try{m(!0),o(""),await We(a,s,r),x("Member role updated successfully!"),await g(a,b),A(!1),C(null),setTimeout(()=>x(""),3e3)}catch(n){const Ae=n instanceof Error?n.message:"Failed to change member role";o(Ae),setTimeout(()=>o(""),5e3)}finally{m(!1)}},je=async s=>{if(a&&window.confirm("Are you sure you want to remove this member from the workspace?"))try{m(!0),o(""),await ze(a,s),x("Member removed successfully!"),await g(a,b),A(!1),C(null),setTimeout(()=>x(""),3e3)}catch(r){const n=r instanceof Error?r.message:"Failed to remove member";o(n),setTimeout(()=>o(""),5e3)}finally{m(!1)}},pe=s=>{S(s),D(!0)},w=async s=>{if(!(!a||!h))try{m(!0),o(""),await T(a,h.id,s),x(`Member status changed to ${s} successfully!`),await g(a,b),D(!1),S(null),setTimeout(()=>x(""),3e3)}catch(r){const n=r instanceof Error?r.message:"Failed to change member status";o(n),setTimeout(()=>o(""),5e3)}finally{m(!1)}},B=()=>{D(!1),S(null)},be=(s,r)=>{a&&g(a,r)},L=s=>{switch(s){case"ACTIVE":return"success";case"DEACTIVATED":return"error";case"PENDING_VERIFY":return"warning";default:return"default"}},Ce=s=>s==="ADMIN"?"primary":"default";if(re)return e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(l,{children:"Loading workspace members..."})});if(R)return e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(l,{color:"error",children:R})});const E=JSON.parse(localStorage.getItem("user")||"{}"),O=()=>{Ie()};if(E.role!=="ADMIN")return e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(l,{color:"error",variant:"h6",children:"Access denied. Admin role required."})});const H=Math.ceil(W/N);return e.jsxs(c,{sx:{display:"flex",minHeight:"100vh",bgcolor:"#f7f8fa"},children:[e.jsx(c,{sx:{display:{xs:"none",md:"block"}},children:e.jsx(G,{userRole:E.role,currentTab:"users",onSignOut:O})}),e.jsx(Ne,{open:de,onClose:()=>he(!1),PaperProps:{sx:{width:240,display:{xs:"block",md:"none"}}},children:e.jsx(G,{userRole:E.role,currentTab:"users",onSignOut:O,isDrawer:!0})}),e.jsxs(c,{sx:{flex:1,display:"flex",flexDirection:"column",ml:{xs:0,md:"220px"}},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,bgcolor:"#fff",boxShadow:1,position:"sticky",top:0,zIndex:10},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(l,{variant:"h4",sx:{fontWeight:700,color:"#222"},children:"Workspace Members"}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"#2950DA",opacity:.7}}),e.jsxs(l,{sx:{color:"#666",fontSize:12},children:[W," members"]})]})]}),e.jsx(Fe,{placeholder:"Search members...",size:"small",InputProps:{startAdornment:e.jsx(Pe,{position:"start",children:e.jsx(Me,{sx:{color:"#bdbdbd"}})}),sx:{borderRadius:3,bgcolor:"#fff",width:{xs:"100%",sm:320},fontSize:18}},value:M,onChange:s=>Q(s.target.value)})]}),z&&e.jsx(I,{severity:"success",sx:{mb:2},children:z}),e.jsxs(Be,{elevation:0,sx:{borderRadius:3,p:3,mt:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsxs(Y,{size:"small",sx:{minWidth:120},children:[e.jsx(J,{children:"Status"}),e.jsxs(q,{value:y,label:"Status",onChange:s=>le(s.target.value),children:[e.jsx(p,{value:"",children:"All"}),e.jsx(p,{value:"ACTIVE",children:"Active"}),e.jsx(p,{value:"DEACTIVATED",children:"Deactivated"}),e.jsx(p,{value:"PENDING_VERIFY",children:"Pending Verify"})]})]}),e.jsxs(Y,{size:"small",sx:{minWidth:120},children:[e.jsx(J,{children:"Role"}),e.jsxs(q,{value:v,label:"Role",onChange:s=>oe(s.target.value),children:[e.jsx(p,{value:"",children:"All"}),e.jsx(p,{value:"ADMIN",children:"Admin"}),e.jsx(p,{value:"MEMBER",children:"Member"})]})]})]}),e.jsx(ye,{sx:{width:"100%",overflowX:"auto"},children:e.jsxs(ve,{size:"small",children:[e.jsx(De,{children:e.jsxs(_,{children:[e.jsx(d,{padding:"checkbox"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Member ID"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Name"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Email"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Role"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Status"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Joined"}),e.jsx(d,{align:"right"})]})}),e.jsx(Se,{children:j.map((s,r)=>e.jsxs(_,{children:[e.jsx(d,{padding:"checkbox",children:e.jsx(Le,{checked:Z.includes(r),onChange:()=>xe(r),icon:e.jsx(Ee,{}),checkedIcon:e.jsx(we,{sx:{color:"#2950DA"}})})}),e.jsx(d,{sx:{fontWeight:700,fontSize:{xs:12,md:16},fontFamily:"monospace",whiteSpace:"nowrap"},children:s.id}),e.jsx(d,{sx:{fontWeight:600,fontSize:{xs:14,md:16}},children:s.name}),e.jsx(d,{sx:{fontWeight:600,fontSize:{xs:14,md:16}},children:s.email}),e.jsx(d,{children:e.jsx(k,{label:s.role,color:Ce(s.role),size:"small"})}),e.jsx(d,{children:e.jsx(k,{label:s.status,color:L(s.status),size:"small",onClick:()=>pe(s),sx:{cursor:"pointer","&:hover":{opacity:.8,transform:"scale(1.05)"}}})}),e.jsx(d,{sx:{fontWeight:600,fontSize:{xs:14,md:16}},children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(d,{align:"right",children:e.jsx(Oe,{title:"View details",children:e.jsx(He,{onClick:()=>ue(s),children:e.jsx(ke,{})})})})]},s.id))})]})}),H>1&&e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mt:3},children:e.jsx(Te,{count:H,page:b,onChange:be,color:"primary",shape:"rounded",size:"large"})})]})]}),e.jsxs(U,{open:ae,onClose:F,maxWidth:"sm",fullWidth:!0,children:[e.jsx(X,{children:"Member Details"}),e.jsx($,{children:t?e.jsxs(c,{children:[e.jsxs(l,{children:[e.jsx("b",{children:"ID:"})," ",t.id]}),e.jsxs(l,{children:[e.jsx("b",{children:"Name:"})," ",t.name]}),e.jsxs(l,{children:[e.jsx("b",{children:"Email:"})," ",t.email]}),e.jsxs(l,{children:[e.jsx("b",{children:"Role:"})," ",t.role]}),e.jsxs(l,{children:[e.jsx("b",{children:"Status:"})," ",t.status]}),e.jsxs(l,{children:[e.jsx("b",{children:"Last Login:"})," ",t.lastLoginAt?new Date(t.lastLoginAt).toLocaleString():"Never"]}),e.jsxs(l,{children:[e.jsx("b",{children:"Joined:"})," ",new Date(t.createdAt).toLocaleString()]}),e.jsxs(c,{sx:{mt:3,display:"flex",gap:2,flexWrap:"wrap"},children:[t.status!=="ACTIVE"&&e.jsx(u,{color:"success",variant:"contained",onClick:()=>fe(t.id),disabled:f,children:"Activate Member"}),t.status==="ACTIVE"&&e.jsx(u,{color:"error",variant:"outlined",onClick:()=>ge(t.id),disabled:f||t.role==="ADMIN",title:t.role==="ADMIN"?"Cannot deactivate an admin. Please change their role to Member first.":"Deactivate this member",children:"Deactivate Member"}),t.role==="MEMBER"&&e.jsx(u,{color:"primary",variant:"outlined",onClick:()=>P(t.id,"ADMIN"),disabled:f,children:"Make Admin"}),t.role==="ADMIN"&&e.jsx(u,{color:"warning",variant:"outlined",onClick:()=>P(t.id,"MEMBER"),disabled:f||j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1,title:j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1?"Cannot demote the only admin in the workspace":"Change role to Member",children:"Make Member"}),e.jsx(u,{color:"error",variant:"outlined",onClick:()=>je(t.id),disabled:f||t.role==="ADMIN"&&j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1,title:t.role==="ADMIN"&&j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1?"Cannot remove the only admin from the workspace":"Remove this member from the workspace",children:"Remove Member"})]}),t.role==="ADMIN"&&j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1&&e.jsx(I,{severity:"warning",sx:{mt:2},children:"This is the only admin in the workspace. At least one admin must remain to manage the workspace."}),t.role==="ADMIN"&&t.status==="ACTIVE"&&e.jsx(I,{severity:"info",sx:{mt:2},children:"Admins cannot be deactivated directly. Please change their role to Member first, then deactivate them."}),t.role==="ADMIN"&&j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1&&e.jsx(I,{severity:"warning",sx:{mt:2},children:"This is the only admin in the workspace. At least one admin must remain to manage the workspace."})]}):e.jsx(l,{children:"No details available."})}),e.jsx(K,{children:e.jsx(u,{onClick:F,children:"Close"})})]}),e.jsxs(U,{open:ce,onClose:B,maxWidth:"sm",fullWidth:!0,children:[e.jsx(X,{children:"Change Member Status"}),e.jsx($,{children:h?e.jsxs(c,{children:[e.jsxs(l,{sx:{mb:2},children:["Change status for"," ",e.jsx("strong",{children:h.name})," (",h.email,")"]}),e.jsxs(l,{sx:{mb:2},children:["Current status:"," ",e.jsx(k,{label:h.status,color:L(h.status),size:"small"})]}),e.jsx(l,{sx:{mb:2,color:"text.secondary"},children:"Select new status:"}),e.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[h.status!=="ACTIVE"&&e.jsx(u,{color:"success",variant:"outlined",onClick:()=>w("ACTIVE"),disabled:f,children:"Activate"}),h.status==="ACTIVE"&&e.jsx(u,{color:"error",variant:"outlined",onClick:()=>w("DEACTIVATED"),disabled:f||h.role==="ADMIN",title:h.role==="ADMIN"?"Cannot deactivate an admin. Please change their role to Member first.":"Deactivate this member",children:"Deactivate"}),h.status!=="PENDING_VERIFY"&&e.jsx(u,{color:"warning",variant:"outlined",onClick:()=>w("PENDING_VERIFY"),disabled:f,children:"Set Pending Verify"})]}),h.role==="ADMIN"&&h.status==="ACTIVE"&&e.jsx(I,{severity:"info",sx:{mt:2},children:"Admins cannot be deactivated directly. Please change their role to Member first, then deactivate them."})]}):e.jsx(l,{children:"No member selected."})}),e.jsx(K,{children:e.jsx(u,{onClick:B,children:"Cancel"})})]})]})};export{js as default};
