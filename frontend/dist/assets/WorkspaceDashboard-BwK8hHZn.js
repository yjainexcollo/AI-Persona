import{r as d,j as o,B as m,T as l}from"./index-DZZOxePK.js";import{A as w,D as C}from"./AdminSidebar-BC3v7hGV.js";import{A as T,f as O}from"./session-OQZ4-gd6.js";import{g as z}from"./workspaceService-DsQ_ATQy.js";import{g as x}from"./avatarService-BCG4JWCu.js";import{B as J}from"./Button-B7J8ztac.js";import{P as W}from"./Paper-HPjR2glp.js";import"./useControlled-BWUAgirZ.js";import"./Menu-ln1C0o4g.js";import"./resolveComponentProps-Bq0HYZcK.js";import"./createSvgIcon-CaBjOyKH.js";import"./createSvgIcon-BIhj4CPR.js";import"./useMediaQuery-CnBkzBGO.js";import"./getThemeProps-BsJW7mXr.js";import"./Divider-Bhdr32rx.js";import"./IconButton-BSLK1csj.js";import"./useSlot-CoHkQtrl.js";const re=({workspaceId:g,workspaceName:i,user:s,stats:j,onUsePersona:D,onSignOut:h})=>{const[S,v]=d.useState(j),[U,I]=d.useState(!1),[A,p]=d.useState(i),[n,u]=d.useState(s),[N,E]=d.useState(!1);d.useEffect(()=>{const r=localStorage.getItem("workspaceName");r&&r.includes("Test Workspace")&&(localStorage.removeItem("workspaceName"),console.log("Cleared test workspace name from localStorage on mount"));const t=localStorage.getItem("user");if(t)try{const e=JSON.parse(t);e.name&&e.name.includes("Test User")&&(localStorage.removeItem("user"),console.log("Cleared test user data from localStorage on mount"))}catch(e){console.warn("Error parsing user data from localStorage:",e)}p(i),console.log("Set workspace name to original prop value:",i)},[i]);const b=()=>{const r=localStorage.getItem("workspaceName");r&&r.includes("Test Workspace")&&(localStorage.removeItem("workspaceName"),console.log("Cleared test workspace name from localStorage")),console.log("Current workspace name from props:",i),console.log("Original workspace name from props:",i),p(i)},k=()=>{try{const r=JSON.parse(localStorage.getItem("user")||"{}");console.log("Current user data from localStorage:",r);const t={name:r.name||s.name||"Demo User",role:r.role||s.role||"Member",avatarUrl:r.avatar||s.avatarUrl||""};console.log("Setting dynamic user to:",t),u(t)}catch(r){console.warn("Error parsing user data from localStorage:",r)}},y=async()=>{try{const t=await O("http://localhost:3000/api/users/me");if(t.ok){const e=await t.json();if(console.log("User data from API:",e),e.status==="success"&&e.data&&e.data.user){const a=e.data.user,c={name:a.name||s.name||"Demo User",role:a.role||s.role||"Member",avatarUrl:a.avatarUrl||s.avatarUrl||""};console.log("Setting dynamic user from API to:",c),u(c);const f={...JSON.parse(localStorage.getItem("user")||"{}"),name:a.name,role:a.role,avatarUrl:a.avatarUrl};localStorage.setItem("user",JSON.stringify(f))}else if(e.data&&e.data.user){const a=e.data.user,c={name:a.name||s.name||"Demo User",role:a.role||s.role||"Member",avatarUrl:a.avatarUrl||s.avatarUrl||""};console.log("Setting dynamic user from API (fallback) to:",c),u(c);const f={...JSON.parse(localStorage.getItem("user")||"{}"),name:a.name,role:a.role,avatarUrl:a.avatarUrl};localStorage.setItem("user",JSON.stringify(f))}else console.log("No user data found in API response:",e)}else console.warn("Failed to fetch user data from API:",t.status)}catch(r){console.warn("Error fetching user data from API:",r)}},P=async()=>{try{const r=await z();console.log("Workspace data from API:",r),console.log("Workspace ID from API:",r.id),console.log("Workspace name from API:",r.name);const t=localStorage.getItem("workspaceName");t&&t.includes("Test Workspace")&&(localStorage.removeItem("workspaceName"),console.log("Cleared test workspace name from localStorage"));const e=localStorage.getItem("user");if(e)try{const a=JSON.parse(e);a.name&&a.name.includes("Test User")&&(localStorage.removeItem("user"),console.log("Cleared test user data from localStorage"))}catch(a){console.warn("Error parsing user data from localStorage:",a)}p(r.name),localStorage.setItem("workspaceName",r.name),localStorage.setItem("workspaceId",r.id)}catch(r){console.error("Error fetching workspace data from API:",r)}};return d.useEffect(()=>{const r=async()=>{I(!0);try{const e="http://localhost:3000";console.log("WorkspaceId:",g),console.log("Backend URL:",e),console.log("Stats endpoint not available, using default values"),v({members:"0",users:"0"})}catch(e){console.warn("Error fetching workspace stats:",e),v({members:"0",users:"0"})}finally{I(!1)}},t=e=>{if(e.key==="workspaceName"&&e.newValue&&p(e.newValue),e.key==="user"&&e.newValue)try{const a=JSON.parse(e.newValue),c={name:a.name||s.name||"Demo User",role:a.role||s.role||"Member",avatarUrl:a.avatar||s.avatarUrl||""};u(c)}catch(a){console.warn("Error parsing user data from storage event:",a)}};if(g&&g!=="demo-workspace"){r(),b(),k(),y(),P();const e=setInterval(r,5e3),a=setInterval(b,5e3),c=setInterval(k,5e3),f=setInterval(y,5e3);return window.addEventListener("storage",t),()=>{clearInterval(e),clearInterval(a),clearInterval(c),clearInterval(f),window.removeEventListener("storage",t)}}},[g,i,s]),o.jsxs(m,{sx:{display:"flex",minHeight:"100vh",bgcolor:"#f8f9fa"},children:[o.jsx(m,{sx:{display:{xs:"none",md:"block"}},children:o.jsx(w,{userRole:n.role,currentTab:"workspace",onSignOut:h,userName:n.name,avatarUrl:x(n.avatarUrl)})}),o.jsx(C,{open:N,onClose:()=>E(!1),PaperProps:{sx:{width:240}},children:o.jsx(w,{userRole:n.role,currentTab:"workspace",onSignOut:h,isDrawer:!0,userName:n.name,avatarUrl:x(n.avatarUrl)})}),o.jsx(m,{sx:{flex:1,display:"flex",flexDirection:"column",ml:{xs:0,md:"220px"}},children:o.jsxs(m,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pt:6},children:[o.jsx(m,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:o.jsx(l,{variant:"h3",sx:{fontWeight:800,color:"#111",textAlign:"center"},children:`Welcome to ${A}`})}),o.jsx(l,{sx:{color:"#6b7280",fontWeight:500,fontSize:18,mb:4,textAlign:"center"},children:"Bring your team in and start deploying AI personas."}),o.jsx(T,{src:x(n.avatarUrl),alt:n.name,sx:{width:80,height:80,mb:1.5}}),o.jsx(m,{sx:{display:"flex",alignItems:"center",gap:2,mb:0},children:o.jsx(l,{sx:{fontWeight:700,fontSize:20,color:"#222"},children:n.name})}),o.jsx(l,{sx:{color:"#6b7280",fontWeight:500,fontSize:16,mb:3},children:n.role}),o.jsx(m,{sx:{display:"flex",gap:2,mb:5},children:o.jsx(J,{variant:"outlined",sx:{color:"#222",fontWeight:700,px:4,textTransform:"none",borderRadius:2,bgcolor:"#f3f6f4",borderColor:"#e0e0e0"},onClick:D,children:"Use Persona"})}),o.jsxs(m,{sx:{display:"flex",gap:3,mt:2},children:[o.jsxs(W,{sx:{p:3,minWidth:180,borderRadius:3,bgcolor:"#f3f6f4",position:"relative"},children:[o.jsx(l,{sx:{color:"#6b7280",fontWeight:500,fontSize:15,mb:1},children:"Members"}),o.jsx(l,{sx:{fontWeight:800,fontSize:24,color:"#111"},children:U?"...":S.members}),o.jsx(l,{sx:{color:"#9ca3af",fontWeight:400,fontSize:12,mt:.5},children:"MEMBER users only"})]}),o.jsxs(W,{sx:{p:3,minWidth:180,borderRadius:3,bgcolor:"#f3f6f4",position:"relative"},children:[o.jsx(l,{sx:{color:"#6b7280",fontWeight:500,fontSize:15,mb:1},children:"Total Users"}),o.jsx(l,{sx:{fontWeight:800,fontSize:24,color:"#111"},children:U?"...":S.users}),o.jsx(l,{sx:{color:"#9ca3af",fontWeight:400,fontSize:12,mt:.5},children:"All users"})]})]})]})})]})};export{re as default};
