import{r as n,j as e,B as l,T as o,n as Ie}from"./index-DYCawVz4.js";import{S as Me}from"./Search--YIJYMiZ.js";import{M as ve}from"./MoreVert-98A5Ki9x.js";import{T as ye,a as De,b as Se,c as G,d,e as we,C as Ee,f as Te,P as ke}from"./CheckBoxOutlineBlank-C7v8zdWr.js";import{c as Y,D as Ne,C as Ve,a as p}from"./AdminSidebar-BvsYjg6b.js";import{g as Re,a as We,c as k,b as Fe,r as ze}from"./workspaceService-DNIeEo99.js";import{T as Pe,F as J,a as U,S as q}from"./TextField-DEyW8a8s.js";import{I as Be}from"./InputAdornment-CMOWfscG.js";import{A as M}from"./Alert-D72j-c0T.js";import{P as Le}from"./Paper-Bgtif2Ge.js";import{C as Oe}from"./Checkbox-DCgHLu7J.js";import{C as N}from"./Chip-CnI6PA8M.js";import{T as He}from"./Tooltip-B2_5ggvG.js";import{I as _e}from"./IconButton-BeZRpjOd.js";import{D as X,a as $,b as K,c as Q}from"./DialogTitle-72MACD6J.js";import{B as u}from"./Button-C_jCaeEK.js";import"./createSvgIcon-C__bowmj.js";import"./createSvgIcon-pvlxLHl_.js";import"./useControlled-B9mKIuas.js";import"./Menu-Cj0BlqQ8.js";import"./resolveComponentProps-RqVTStnW.js";import"./HomeOutlined-28NUgevx.js";import"./session-sYSmwvGn.js";import"./useSlot-BHojEugq.js";import"./Divider-DltVXmpm.js";import"./SwitchBase-C-v0Ae8P.js";const gs=()=>{const[v,Z]=n.useState(""),[ee,se]=n.useState([]),[b,te]=n.useState(1),[V]=n.useState(20),[j,re]=n.useState([]),[ae,R]=n.useState(!0),[W,c]=n.useState(""),[t,C]=n.useState(null),[ne,A]=n.useState(!1),[a,ie]=n.useState(""),[F,le]=n.useState(0),[y,oe]=n.useState(""),[D,ce]=n.useState(""),[f,m]=n.useState(!1),[z,x]=n.useState(""),[de,S]=n.useState(!1),[h,w]=n.useState(null),[he,P]=n.useState(!1),me=async()=>{try{R(!0),c("");const s=await Re();ie(s.id),await g(s.id)}catch(s){c(s instanceof Error?s.message:"Failed to load workspace data")}finally{R(!1)}},g=async(s,r=1)=>{try{const i=await We(s,{search:v||void 0,status:y||void 0,role:D||void 0,page:r,limit:V});re(i.data),le(i.pagination.total),te(r)}catch(i){console.error("Error fetching members:",i),c(i instanceof Error?i.message:"Failed to load members")}};n.useEffect(()=>{me()},[]),n.useEffect(()=>{a&&g(a,1)},[v,y,D,a]);const xe=s=>{se(r=>r.includes(s)?r.filter(i=>i!==s):[...r,s])},ue=s=>{C(s),A(!0)},B=()=>{A(!1),C(null)},fe=async s=>{if(a)try{m(!0),await k(a,s,"ACTIVE"),x("Member activated successfully!"),await g(a,b),A(!1),C(null),setTimeout(()=>x(""),3e3)}catch(r){c(r instanceof Error?r.message:"Failed to activate member")}finally{m(!1)}},ge=async s=>{if(a)try{m(!0),c(""),await k(a,s,"DEACTIVATED"),x("Member deactivated successfully!"),await g(a,b),A(!1),C(null),setTimeout(()=>x(""),3e3)}catch(r){const i=r instanceof Error?r.message:"Failed to deactivate member";c(i),setTimeout(()=>c(""),5e3)}finally{m(!1)}},L=async(s,r)=>{if(a)try{m(!0),c(""),await Fe(a,s,r),x("Member role updated successfully!"),await g(a,b),A(!1),C(null),setTimeout(()=>x(""),3e3)}catch(i){const Ae=i instanceof Error?i.message:"Failed to change member role";c(Ae),setTimeout(()=>c(""),5e3)}finally{m(!1)}},je=async s=>{if(a&&window.confirm("Are you sure you want to remove this member from the workspace?"))try{m(!0),c(""),await ze(a,s),x("Member removed successfully!"),await g(a,b),A(!1),C(null),setTimeout(()=>x(""),3e3)}catch(r){const i=r instanceof Error?r.message:"Failed to remove member";c(i),setTimeout(()=>c(""),5e3)}finally{m(!1)}},pe=s=>{w(s),S(!0)},E=async s=>{if(!(!a||!h))try{m(!0),c(""),await k(a,h.id,s),x(`Member status changed to ${s} successfully!`),await g(a,b),S(!1),w(null),setTimeout(()=>x(""),3e3)}catch(r){const i=r instanceof Error?r.message:"Failed to change member status";c(i),setTimeout(()=>c(""),5e3)}finally{m(!1)}},O=()=>{S(!1),w(null)},be=(s,r)=>{a&&g(a,r)},H=s=>{switch(s){case"ACTIVE":return"success";case"DEACTIVATED":return"error";case"PENDING_VERIFY":return"warning";default:return"default"}},Ce=s=>s==="ADMIN"?"primary":"default";if(ae)return e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(o,{children:"Loading workspace members..."})});if(W)return e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(o,{color:"error",children:W})});const I=JSON.parse(localStorage.getItem("user")||"{}"),T=()=>{Ie()};if(I.role!=="ADMIN")return e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(o,{color:"error",variant:"h6",children:"Access denied. Admin role required."})});const _=Math.ceil(F/V);return e.jsxs(l,{sx:{display:"flex",minHeight:"100vh",bgcolor:"#f7f8fa"},children:[e.jsx(l,{sx:{display:{xs:"none",md:"block"}},children:e.jsx(Y,{userRole:I.role,currentTab:"users",onSignOut:T})}),e.jsx(Ne,{open:he,onClose:()=>P(!1),PaperProps:{sx:{width:240,display:{xs:"block",md:"none"}}},children:e.jsx(Y,{userRole:I.role,currentTab:"users",onSignOut:T,isDrawer:!0})}),e.jsxs(l,{sx:{flex:1,display:"flex",flexDirection:"column",ml:{xs:0,md:"220px"}},children:[e.jsx(Ve,{user:{name:I.name||"User",role:I.role||"Member",avatarUrl:I.avatar||""},onSignOut:T,onToggleSidebar:()=>P(!0)}),e.jsxs(l,{sx:{flex:1,px:{xs:2,md:6},py:{xs:2,md:4}},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:{xs:"flex-start",md:"space-between"},alignItems:{xs:"stretch",md:"center"},mb:2,flexDirection:{xs:"column",md:"row"},gap:{xs:1.5,md:0}},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(o,{variant:"h4",sx:{fontWeight:700,color:"#222"},children:"Workspace Members"}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(l,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"#2950DA",opacity:.7}}),e.jsxs(o,{sx:{color:"#666",fontSize:12},children:[F," members"]})]})]}),e.jsx(Pe,{placeholder:"Search members...",size:"small",InputProps:{startAdornment:e.jsx(Be,{position:"start",children:e.jsx(Me,{sx:{color:"#bdbdbd"}})}),sx:{borderRadius:3,bgcolor:"#fff",width:{xs:"100%",sm:320},fontSize:18}},value:v,onChange:s=>Z(s.target.value)})]}),z&&e.jsx(M,{severity:"success",sx:{mb:2},children:z}),e.jsxs(Le,{elevation:0,sx:{borderRadius:3,p:3,mt:2},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsxs(J,{size:"small",sx:{minWidth:120},children:[e.jsx(U,{children:"Status"}),e.jsxs(q,{value:y,label:"Status",onChange:s=>oe(s.target.value),children:[e.jsx(p,{value:"",children:"All"}),e.jsx(p,{value:"ACTIVE",children:"Active"}),e.jsx(p,{value:"DEACTIVATED",children:"Deactivated"}),e.jsx(p,{value:"PENDING_VERIFY",children:"Pending Verify"})]})]}),e.jsxs(J,{size:"small",sx:{minWidth:120},children:[e.jsx(U,{children:"Role"}),e.jsxs(q,{value:D,label:"Role",onChange:s=>ce(s.target.value),children:[e.jsx(p,{value:"",children:"All"}),e.jsx(p,{value:"ADMIN",children:"Admin"}),e.jsx(p,{value:"MEMBER",children:"Member"})]})]})]}),e.jsx(ye,{sx:{width:"100%",overflowX:"auto"},children:e.jsxs(De,{size:"small",children:[e.jsx(Se,{children:e.jsxs(G,{children:[e.jsx(d,{padding:"checkbox"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Member ID"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Name"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Email"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Role"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Status"}),e.jsx(d,{sx:{fontWeight:800,fontSize:{xs:14,md:16}},children:"Joined"}),e.jsx(d,{align:"right"})]})}),e.jsx(we,{children:j.map((s,r)=>e.jsxs(G,{children:[e.jsx(d,{padding:"checkbox",children:e.jsx(Oe,{checked:ee.includes(r),onChange:()=>xe(r),icon:e.jsx(Te,{}),checkedIcon:e.jsx(Ee,{sx:{color:"#2950DA"}})})}),e.jsx(d,{sx:{fontWeight:700,fontSize:{xs:12,md:16},fontFamily:"monospace",whiteSpace:"nowrap"},children:s.id}),e.jsx(d,{sx:{fontWeight:600,fontSize:{xs:14,md:16}},children:s.name}),e.jsx(d,{sx:{fontWeight:600,fontSize:{xs:14,md:16}},children:s.email}),e.jsx(d,{children:e.jsx(N,{label:s.role,color:Ce(s.role),size:"small"})}),e.jsx(d,{children:e.jsx(N,{label:s.status,color:H(s.status),size:"small",onClick:()=>pe(s),sx:{cursor:"pointer","&:hover":{opacity:.8,transform:"scale(1.05)"}}})}),e.jsx(d,{sx:{fontWeight:600,fontSize:{xs:14,md:16}},children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(d,{align:"right",children:e.jsx(He,{title:"View details",children:e.jsx(_e,{onClick:()=>ue(s),children:e.jsx(ve,{})})})})]},s.id))})]})}),_>1&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mt:3},children:e.jsx(ke,{count:_,page:b,onChange:be,color:"primary",shape:"rounded",size:"large"})})]})]})]}),e.jsxs(X,{open:ne,onClose:B,maxWidth:"sm",fullWidth:!0,children:[e.jsx($,{children:"Member Details"}),e.jsx(K,{children:t?e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx("b",{children:"ID:"})," ",t.id]}),e.jsxs(o,{children:[e.jsx("b",{children:"Name:"})," ",t.name]}),e.jsxs(o,{children:[e.jsx("b",{children:"Email:"})," ",t.email]}),e.jsxs(o,{children:[e.jsx("b",{children:"Role:"})," ",t.role]}),e.jsxs(o,{children:[e.jsx("b",{children:"Status:"})," ",t.status]}),e.jsxs(o,{children:[e.jsx("b",{children:"Last Login:"})," ",t.lastLoginAt?new Date(t.lastLoginAt).toLocaleString():"Never"]}),e.jsxs(o,{children:[e.jsx("b",{children:"Joined:"})," ",new Date(t.createdAt).toLocaleString()]}),e.jsxs(l,{sx:{mt:3,display:"flex",gap:2,flexWrap:"wrap"},children:[t.status!=="ACTIVE"&&e.jsx(u,{color:"success",variant:"contained",onClick:()=>fe(t.id),disabled:f,children:"Activate Member"}),t.status==="ACTIVE"&&e.jsx(u,{color:"error",variant:"outlined",onClick:()=>ge(t.id),disabled:f||t.role==="ADMIN",title:t.role==="ADMIN"?"Cannot deactivate an admin. Please change their role to Member first.":"Deactivate this member",children:"Deactivate Member"}),t.role==="MEMBER"&&e.jsx(u,{color:"primary",variant:"outlined",onClick:()=>L(t.id,"ADMIN"),disabled:f,children:"Make Admin"}),t.role==="ADMIN"&&e.jsx(u,{color:"warning",variant:"outlined",onClick:()=>L(t.id,"MEMBER"),disabled:f||j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1,title:j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1?"Cannot demote the only admin in the workspace":"Change role to Member",children:"Make Member"}),e.jsx(u,{color:"error",variant:"outlined",onClick:()=>je(t.id),disabled:f||t.role==="ADMIN"&&j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1,title:t.role==="ADMIN"&&j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1?"Cannot remove the only admin from the workspace":"Remove this member from the workspace",children:"Remove Member"})]}),t.role==="ADMIN"&&j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1&&e.jsx(M,{severity:"warning",sx:{mt:2},children:"This is the only admin in the workspace. At least one admin must remain to manage the workspace."}),t.role==="ADMIN"&&t.status==="ACTIVE"&&e.jsx(M,{severity:"info",sx:{mt:2},children:"Admins cannot be deactivated directly. Please change their role to Member first, then deactivate them."}),t.role==="ADMIN"&&j.filter(s=>s.role==="ADMIN"&&s.status==="ACTIVE").length===1&&e.jsx(M,{severity:"warning",sx:{mt:2},children:"This is the only admin in the workspace. At least one admin must remain to manage the workspace."})]}):e.jsx(o,{children:"No details available."})}),e.jsx(Q,{children:e.jsx(u,{onClick:B,children:"Close"})})]}),e.jsxs(X,{open:de,onClose:O,maxWidth:"sm",fullWidth:!0,children:[e.jsx($,{children:"Change Member Status"}),e.jsx(K,{children:h?e.jsxs(l,{children:[e.jsxs(o,{sx:{mb:2},children:["Change status for"," ",e.jsx("strong",{children:h.name})," (",h.email,")"]}),e.jsxs(o,{sx:{mb:2},children:["Current status:"," ",e.jsx(N,{label:h.status,color:H(h.status),size:"small"})]}),e.jsx(o,{sx:{mb:2,color:"text.secondary"},children:"Select new status:"}),e.jsxs(l,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[h.status!=="ACTIVE"&&e.jsx(u,{color:"success",variant:"outlined",onClick:()=>E("ACTIVE"),disabled:f,children:"Activate"}),h.status==="ACTIVE"&&e.jsx(u,{color:"error",variant:"outlined",onClick:()=>E("DEACTIVATED"),disabled:f||h.role==="ADMIN",title:h.role==="ADMIN"?"Cannot deactivate an admin. Please change their role to Member first.":"Deactivate this member",children:"Deactivate"}),h.status!=="PENDING_VERIFY"&&e.jsx(u,{color:"warning",variant:"outlined",onClick:()=>E("PENDING_VERIFY"),disabled:f,children:"Set Pending Verify"})]}),h.role==="ADMIN"&&h.status==="ACTIVE"&&e.jsx(M,{severity:"info",sx:{mt:2},children:"Admins cannot be deactivated directly. Please change their role to Member first, then deactivate them."})]}):e.jsx(o,{children:"No member selected."})}),e.jsx(Q,{children:e.jsx(u,{onClick:O,children:"Cancel"})})]})]})};export{gs as default};
