import{g as ct,a as dt,r as a,u as xt,_ as ht,b as je,j as e,s as ft,c as pt,d as He,e as ut,f as _,h as U,i as F,k as Ce,l as mt,m as qe,R as we,B as o,n as gt,T as g,C as pe,o as vt,p as bt,q as Ae}from"./index-DYCawVz4.js";import{r as H}from"./createSvgIcon-C__bowmj.js";import{E as yt}from"./Edit-L_3JPsAI.js";import{C as jt}from"./Close-w3ZB34Hy.js";import{A as wt,T as St,M as Ct,a as Re,S as It}from"./AdminSidebar-BvsYjg6b.js";import{C as kt,L as M,a as We,b as O,c as zt}from"./Logout-DKgDsamw.js";import At from"./SettingsPage-BGGOkA7M.js";import{u as Be,S as Rt}from"./Stack-B-cO6J0H.js";import{I as D}from"./IconButton-BeZRpjOd.js";import{B as le}from"./Button-C_jCaeEK.js";import{D as $e,a as Wt,b as Dt,c as Lt}from"./DialogTitle-72MACD6J.js";import{A as $}from"./session-sYSmwvGn.js";import{P as Et,L as fe,M as Mt}from"./Menu-Cj0BlqQ8.js";import{D as Pt}from"./Divider-DltVXmpm.js";import{g as Ne,a as Ke,c as Tt,t as Ot,b as De,d as _t,e as Ut,s as Ft}from"./personaService-ZsIsG1EY.js";import{C as Ge,S as Ht,a as qt}from"./ConversationSettingsDialog-CF7-Wnf-.js";import{C as Bt}from"./ChevronLeft-BuPp86RS.js";import{c as ue}from"./createSvgIcon-pvlxLHl_.js";import{L as he}from"./ListItemAvatar-DHqXuO8q.js";import{P as $t,F as Nt}from"./FormattedOutput-DnRerFk2.js";import{C as Kt}from"./ChatInputBar-BfrovCAD.js";import{T as Le}from"./Tooltip-B2_5ggvG.js";import{A as Ve}from"./Alert-D72j-c0T.js";import{T as Gt}from"./TextField-DEyW8a8s.js";import"./useControlled-B9mKIuas.js";import"./Paper-Bgtif2Ge.js";import"./HomeOutlined-28NUgevx.js";import"./resolveComponentProps-RqVTStnW.js";import"./SwitchBase-C-v0Ae8P.js";import"./useThemeProps-CsaTaIua.js";import"./useSlot-BHojEugq.js";import"./Person-COs1LVRe.js";import"./Chip-CnI6PA8M.js";function Vt(n){return ct("MuiListSubheader",n)}dt("MuiListSubheader",["root","colorPrimary","colorInherit","gutters","inset","sticky"]);const Xt=["className","color","component","disableGutters","disableSticky","inset"],Yt=n=>{const{classes:i,color:d,disableGutters:h,inset:s,disableSticky:b}=n,I={root:["root",d!=="default"&&`color${He(d)}`,!h&&"gutters",s&&"inset",!b&&"sticky"]};return ut(I,Vt,i)},Jt=ft("li",{name:"MuiListSubheader",slot:"Root",overridesResolver:(n,i)=>{const{ownerState:d}=n;return[i.root,d.color!=="default"&&i[`color${He(d.color)}`],!d.disableGutters&&i.gutters,d.inset&&i.inset,!d.disableSticky&&i.sticky]}})(({theme:n,ownerState:i})=>je({boxSizing:"border-box",lineHeight:"48px",listStyle:"none",color:(n.vars||n).palette.text.secondary,fontFamily:n.typography.fontFamily,fontWeight:n.typography.fontWeightMedium,fontSize:n.typography.pxToRem(14)},i.color==="primary"&&{color:(n.vars||n).palette.primary.main},i.color==="inherit"&&{color:"inherit"},!i.disableGutters&&{paddingLeft:16,paddingRight:16},i.inset&&{paddingLeft:72},!i.disableSticky&&{position:"sticky",top:0,zIndex:1,backgroundColor:(n.vars||n).palette.background.paper})),Se=a.forwardRef(function(i,d){const h=xt({props:i,name:"MuiListSubheader"}),{className:s,color:b="default",component:I="li",disableGutters:R=!1,disableSticky:w=!1,inset:p=!1}=h,k=ht(h,Xt),y=je({},h,{color:b,component:I,disableGutters:R,disableSticky:w,inset:p}),L=Yt(y);return e.jsx(Jt,je({as:I,className:pt(L.root,s),ref:d,ownerState:y},k))});Se.muiSkipListHighlight=!0;var ee={},Ee;function Qt(){if(Ee)return ee;Ee=1;var n=_();Object.defineProperty(ee,"__esModule",{value:!0}),ee.default=void 0;var i=n(H()),d=U();return ee.default=(0,i.default)((0,d.jsx)("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"ChevronLeft"),ee}var Zt=Qt();const es=F(Zt);var te={},Me;function ts(){if(Me)return te;Me=1;var n=_();Object.defineProperty(te,"__esModule",{value:!0}),te.default=void 0;var i=n(H()),d=U();return te.default=(0,i.default)((0,d.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),te}var ss=ts();const os=F(ss);var se={},Pe;function rs(){if(Pe)return se;Pe=1;var n=_();Object.defineProperty(se,"__esModule",{value:!0}),se.default=void 0;var i=n(H()),d=U();return se.default=(0,i.default)((0,d.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),se}var ns=rs();const is=F(ns),as=ue(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),ls=ue(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),cs=ue(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),ds=ue(e.jsx("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92"}),"Share");var oe={},Te;function xs(){if(Te)return oe;Te=1;var n=_();Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=void 0;var i=n(H()),d=U();return oe.default=(0,i.default)((0,d.jsx)("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline"),oe}var hs=xs();const fs=F(hs),ps=({onBack:n,onMenu:i,isSidebarOpen:d,backIcon:h})=>{const s=Ce(),b=mt(),I=qe(),R=Be(I.breakpoints.down("md")),w=280,[p,k]=we.useState(null),y=!!p,L=q=>{k(q.currentTarget)},E=()=>{k(null)},v=()=>{E(),gt()},[j,P]=we.useState(!1),T=()=>P(!0),z=()=>P(!1);return e.jsxs(wt,{position:"relative",elevation:0,sx:{backgroundColor:"#fff",color:"#333",boxShadow:"none",borderBottom:"1px solid #e9ecef"},children:[e.jsxs(St,{sx:{justifyContent:"space-between",px:{xs:2,sm:3},minHeight:{xs:56,sm:64}},children:[d&&e.jsx(o,{sx:{width:`${w}px`,flexShrink:0}}),e.jsx(o,{sx:{display:"flex",alignItems:"center",gap:.5,transition:"margin-left 0.3s cubic-bezier(.4,0,.2,1)"},children:!d&&e.jsxs(e.Fragment,{children:[e.jsx(D,{size:"small",onClick:n,"aria-label":"Go back",sx:{fontSize:{xs:24,sm:28},color:"#000",fontWeight:900,fontFamily:"Inter, Roboto, Helvetica, Arial, sans-serif",p:{xs:.8,sm:1},mr:.2,background:"none",border:"none",borderRadius:0,boxShadow:"none","&:hover":{color:"#2950DA",background:"none"}},children:typeof h<"u"?h:e.jsx(is,{})}),e.jsx(D,{size:"small","aria-label":"Open menu",sx:{color:"#000",fontSize:{xs:20,sm:22},fontWeight:900,fontFamily:"Inter, Roboto, Helvetica, Arial, sans-serif",p:{xs:.6,sm:.7},ml:.2,background:"none",border:"none",borderRadius:0,boxShadow:"none","&:hover":{color:"#2950DA",background:"none"}},onClick:i,children:e.jsx(Ct,{sx:{fontSize:{xs:20,sm:22},fontWeight:900}})})]})}),e.jsx(o,{sx:{display:"flex",alignItems:"center",gap:4,flex:1,mx:{xs:2,sm:4}}}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:{xs:.5,sm:1}},children:[!R&&e.jsxs(Rt,{direction:"row",children:[e.jsx(le,{sx:{color:b.pathname==="/discovery"?"#2950DA":"#666",fontFamily:"Inter, Roboto, Helvetica, Arial, sans-serif",fontWeight:500,fontSize:"16px",lineHeight:"24px",letterSpacing:0,textTransform:"none","&:hover":{backgroundColor:"transparent",color:"#2950DA"}},onClick:()=>s("/discovery"),children:"Discover"}),e.jsx(le,{sx:{color:b.pathname==="/chat-history"?"#2950DA":"#666",fontFamily:"Inter, Roboto, Helvetica, Arial, sans-serif",fontWeight:500,fontSize:"16px",lineHeight:"24px",letterSpacing:0,textTransform:"none","&:hover":{backgroundColor:"transparent",color:"#2950DA"}},onClick:()=>s("/chat-history"),children:"Chat History"})]}),e.jsxs(e.Fragment,{children:[e.jsx(D,{sx:{color:"#666"},onClick:T,"aria-label":"Open settings",children:e.jsx(kt,{size:R?20:24})}),e.jsx($e,{open:j,onClose:z,fullScreen:!0,"aria-labelledby":"settings-dialog-title",PaperProps:{sx:{m:0,borderRadius:0,width:"100%",height:"100%",overflow:"hidden"}},children:e.jsx(At,{})})]}),e.jsx(le,{onClick:L,sx:{minWidth:0,p:.5},"aria-haspopup":"menu","aria-expanded":y?"true":void 0,"aria-label":"Open profile menu",children:e.jsx($,{src:"https://img.freepik.com/free-vector/smiling-young-man-illustration_1308-174669.jpg?semt=ais_hybrid&w=740",sx:{width:{xs:28,sm:32},height:{xs:28,sm:32}},imgProps:{loading:"lazy"}})})]})]}),e.jsx(Et,{open:y,anchorEl:p,onClose:E,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{mt:1,minWidth:200,boxShadow:"0 4px 20px rgba(0,0,0,0.15)",borderRadius:3}},children:e.jsxs(fe,{sx:{py:0},children:[e.jsxs(M,{button:!0,children:[e.jsx(We,{children:e.jsx(fs,{})}),e.jsx(O,{primary:"Help & Support"})]}),e.jsx(Pt,{}),e.jsxs(M,{button:!0,onClick:v,children:[e.jsx(We,{children:e.jsx(zt,{})}),e.jsx(O,{primary:"Logout"})]})]})})]})},us=({onClose:n,currentPersonaId:i,onSearchChats:d})=>{const h=Ce(),[s,b]=a.useState([]),[I,R]=a.useState([]),[w,p]=a.useState(!1),[k,y]=a.useState([]),[L,E]=a.useState(!1),[v]=a.useState(""),[j,P]=a.useState(null),[T,z]=a.useState(null),[q,Y]=a.useState(!1),[J,N]=a.useState(null);a.useEffect(()=>{async function x(){try{const f=await Ne();b(f.data||[])}catch(f){console.error("Error fetching personas from backend:",f),b([])}}x()},[]),a.useEffect(()=>{(async()=>{p(!0);try{const f=s.filter(u=>u.isFavourited).map(u=>({id:u.id,name:u.name,avatar:u.avatarUrl||u.avatar||"",role:u.role||""}));R(f)}catch(f){console.error("Error fetching favorites:",f),R([])}p(!1)})()},[s]),a.useEffect(()=>{(async()=>{E(!0);try{const u=(await Ke()).data||[];if(i){const W=u.filter(X=>X.personaId===i).sort((X,xe)=>new Date(xe.updatedAt).getTime()-new Date(X.updatedAt).getTime()).slice(0,10);y(W)}else y([])}catch(f){console.error("Error fetching recent chats:",f),y([])}E(!1)})()},[i]);const K=()=>{const x=s[0];if(x){const f=Date.now().toString();h(`/chat/${x.id}?session=${f}`),n&&n()}},ce=x=>{h(`/chat/${x}`),n&&n()},G=()=>{d&&d(),n&&n()},V=async(x,f)=>{f.stopPropagation(),console.log("Share button clicked for conversation:",x);try{const W=(await Tt(x)).data.url;await navigator.clipboard.writeText(W),console.log("Share link copied to clipboard:",W)}catch(u){console.error("Error creating share link:",u)}},de=(x,f)=>{x.stopPropagation(),P(x.currentTarget),z(f)},Q=()=>{P(null),z(null)},S=x=>{const f=k.find(u=>u.id===x);f&&(N(f),Y(!0)),Q()},Z=(x,f)=>{y(u=>u.map(W=>W.id===x?{...W,...f}:W))},me=()=>{Y(!1),N(null)},ge=x=>{const f=x.personaId,u=x.id;f&&u&&(h(`/chat/${f}?conversationId=${u}`),n&&n())};return e.jsxs(o,{sx:{width:320,height:"100vh",bgcolor:"#fff",p:0,boxSizing:"border-box",display:"flex",flexDirection:"column",borderRight:"1px solid #e0e0e0",overflowY:"auto",overflowX:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:{xs:2,sm:3},px:0,py:{xs:1,sm:1.5},mt:{xs:1,sm:1.8},pt:0,pl:{xs:1.5,sm:2}},children:[e.jsx(D,{onClick:n,sx:{color:"#012A1F",fontSize:{xs:24,sm:28},p:0,minWidth:{xs:40,sm:32},minHeight:{xs:40,sm:32},mr:.2,fontWeight:900},children:e.jsx(Bt,{sx:{fontSize:{xs:24,sm:28},color:"#012A1F"}})}),e.jsx(g,{variant:"h5",sx:{fontFamily:"Inter, Roboto, Helvetica, Arial, sans-serif",fontWeight:700,fontSize:{xs:"16px",sm:"18px"},lineHeight:{xs:"20px",sm:"23px"},letterSpacing:0,color:"#0D1A12",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",ml:{xs:1,sm:1.2}},children:"Crudo.ai"})]}),e.jsx(le,{variant:"contained",startIcon:e.jsx(as,{}),disabled:s.length===0,sx:{bgcolor:"#2950DA",color:"#fff",borderRadius:3,fontWeight:500,fontSize:{xs:16,sm:19},py:{xs:2.5,sm:2.8},mb:{xs:1.5,sm:1.9},mt:{xs:2,sm:2.5},boxShadow:"none",textTransform:"none",width:"calc(100% - 32px)",minWidth:0,letterSpacing:.1,"&:hover":{bgcolor:"#526794"},mx:2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},onClick:K,children:"New chat"}),e.jsxs(fe,{sx:{mb:{xs:2,sm:2.5},mx:{xs:1.5,sm:2},width:"100%",maxWidth:"100%"},children:[e.jsxs(M,{button:!0,sx:{px:0,mb:{xs:1,sm:1.2},minWidth:0},onClick:()=>h(`/view-persona/${i||s[0]&&s[0].id}`),children:[e.jsx(he,{sx:{minWidth:{xs:40,sm:32}},children:e.jsx($t,{sx:{color:"#222",fontSize:{xs:24,sm:22},marginTop:.5}})}),e.jsx(O,{primary:e.jsx(g,{sx:{fontWeight:500,color:"#222",fontSize:{xs:15,sm:16},whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"View Persona"})})]}),e.jsxs(M,{button:!0,sx:{px:0,minWidth:0},onClick:G,children:[e.jsx(he,{sx:{minWidth:{xs:40,sm:32}},children:e.jsx(cs,{sx:{color:"#222",fontSize:{xs:24,sm:22},marginTop:.5}})}),e.jsx(O,{primary:e.jsx(g,{sx:{fontWeight:500,color:"#222",fontSize:{xs:15,sm:16},whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Search Chats"})})]})]}),e.jsx(fe,{sx:{mb:{xs:1.5,sm:2},mx:{xs:1.5,sm:2},width:"100%",maxWidth:"100%"},subheader:e.jsx(Se,{component:"div",disableSticky:!0,sx:{bgcolor:"transparent",fontWeight:800,color:"#111",fontSize:{xs:20,sm:22},letterSpacing:-1,px:0,py:.1,mt:-1.2,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"Favorite Personas"}),children:w?e.jsx(M,{sx:{px:0,py:{xs:1,sm:1.2},minWidth:0},children:e.jsx(O,{primary:e.jsx(g,{sx:{fontWeight:500,color:"#888",fontSize:{xs:14,sm:15},fontStyle:"italic"},children:"Loading favorites..."})})}):I.length>0?I.map(x=>e.jsxs(M,{button:!0,sx:{px:0,py:{xs:1,sm:1.2},minWidth:0},onClick:()=>ce(x.id),children:[e.jsx(he,{sx:{minWidth:{xs:44,sm:36}},children:e.jsx($,{src:x.avatar||"",sx:{width:{xs:36,sm:32},height:{xs:36,sm:32},mr:1}})}),e.jsx(O,{primary:e.jsx(g,{sx:{fontWeight:500,color:"#222",fontSize:{xs:14,sm:15},whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:x.name}),secondary:x.role&&e.jsx(g,{sx:{color:"#666",fontSize:{xs:12,sm:13},whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:x.role})})]},x.id)):e.jsx(M,{sx:{px:0,py:{xs:1,sm:1.2},minWidth:0},children:e.jsx(O,{primary:e.jsx(g,{sx:{fontWeight:500,color:"#888",fontSize:{xs:14,sm:15},fontStyle:"italic"},children:"No favorite personas yet"})})})}),e.jsx(fe,{sx:{mx:{xs:1.5,sm:2},width:"100%",maxWidth:"100%"},subheader:e.jsx(Se,{component:"div",disableSticky:!0,sx:{bgcolor:"transparent",fontWeight:800,color:"#111",fontSize:{xs:18,sm:20},letterSpacing:-1,px:0,py:.5,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},children:v?`${v} Chats`:"Recent Chats"}),children:L?e.jsx(M,{sx:{px:0,py:{xs:1,sm:1.2},minWidth:0},children:e.jsx(O,{primary:e.jsx(g,{sx:{fontWeight:500,color:"#888",fontSize:{xs:14,sm:15},fontStyle:"italic"},children:"Loading recent chats..."})})}):k.length>0?k.map(x=>{var f,u;return e.jsxs(M,{button:!0,sx:{px:0,py:{xs:1,sm:1.2},minWidth:0,display:"flex",alignItems:"center",gap:1,overflow:"visible"},onClick:()=>ge(x),children:[e.jsx(he,{sx:{minWidth:36,flexShrink:0},children:e.jsx($,{src:((f=x.persona)==null?void 0:f.avatarUrl)||"",sx:{width:28,height:28,mr:1}})}),e.jsxs(o,{sx:{flex:1,minWidth:0,overflow:"visible",display:"flex",flexDirection:"column",pr:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",width:"100%",mb:0},children:[e.jsx(g,{sx:{fontWeight:500,color:"#222",fontSize:14,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flex:"1 1 0%",minWidth:0,maxWidth:"calc(100% - 40px)",mr:0},children:((u=x.persona)==null?void 0:u.name)||"Unknown Persona"}),e.jsx(D,{size:"small",onClick:W=>de(W,x.id),sx:{color:"#666",flexShrink:0,p:"4px",ml:.5,"&:hover":{color:"#1976d2",backgroundColor:"rgba(25, 118, 210, 0.08)"}},children:e.jsx(ls,{sx:{fontSize:16}})})]}),e.jsx(g,{sx:{color:"#666",fontSize:12,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",minWidth:0},children:x.lastMessage||"No messages"})]})]},x.id)}):e.jsx(M,{sx:{px:0,py:{xs:1,sm:1.2},minWidth:0},children:e.jsx(O,{primary:e.jsx(g,{sx:{fontWeight:500,color:"#888",fontSize:{xs:14,sm:15},fontStyle:"italic"},children:v?`No ${v} chats yet`:"No recent chats"})})})}),e.jsxs(Mt,{anchorEl:j,open:!!j,onClose:Q,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:[e.jsxs(Re,{onClick:()=>{T&&V(T,{}),Q()},children:[e.jsx(ds,{sx:{mr:1}})," Share"]}),e.jsxs(Re,{onClick:()=>{T&&S(T)},children:[e.jsx(It,{sx:{mr:1}})," Conversation Settings"]})]}),e.jsx(Ge,{open:q,onClose:me,conversation:J,onConversationUpdate:Z})]})};var re={},Oe;function ms(){if(Oe)return re;Oe=1;var n=_();Object.defineProperty(re,"__esModule",{value:!0}),re.default=void 0;var i=n(H()),d=U();return re.default=(0,i.default)((0,d.jsx)("path",{d:"M1 21h4V9H1zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73z"}),"ThumbUp"),re}var gs=ms();const vs=F(gs);var ne={},_e;function bs(){if(_e)return ne;_e=1;var n=_();Object.defineProperty(ne,"__esModule",{value:!0}),ne.default=void 0;var i=n(H()),d=U();return ne.default=(0,i.default)((0,d.jsx)("path",{d:"M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2m4 0v12h4V3z"}),"ThumbDown"),ne}var ys=bs();const js=F(ys),ws=({messageId:n,reactions:i=[],currentUserId:d,onReactionUpdate:h,disabled:s=!1})=>{const[b,I]=a.useState(!1),[R,w]=a.useState(null),p=i.find(v=>v.userId===d),k=i.filter(v=>v.type==="LIKE").length,y=i.filter(v=>v.type==="DISLIKE").length,L=async v=>{if(!(s||b)){I(!0),w(null);try{const j=await Ot(n,v);h&&h(n,j.data)}catch(j){const P=j instanceof Error?j.message:"Failed to update reaction";w(P)}finally{I(!1)}}},E=()=>{w(null)};return e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.5,mt:1},children:[e.jsx(Le,{title:`${k} like${k!==1?"s":""}`,children:e.jsx(D,{size:"small",onClick:()=>L("LIKE"),disabled:s||b,sx:{color:(p==null?void 0:p.type)==="LIKE"?"#1976d2":"#666",bgcolor:(p==null?void 0:p.type)==="LIKE"?"rgba(25, 118, 210, 0.1)":"transparent","&:hover":{bgcolor:(p==null?void 0:p.type)==="LIKE"?"rgba(25, 118, 210, 0.2)":"rgba(0, 0, 0, 0.04)"}},children:b?e.jsx(pe,{size:16}):e.jsx(vs,{fontSize:"small"})})}),e.jsx(Le,{title:`${y} dislike${y!==1?"s":""}`,children:e.jsx(D,{size:"small",onClick:()=>L("DISLIKE"),disabled:s||b,sx:{color:(p==null?void 0:p.type)==="DISLIKE"?"#d32f2f":"#666",bgcolor:(p==null?void 0:p.type)==="DISLIKE"?"rgba(211, 47, 47, 0.1)":"transparent","&:hover":{bgcolor:(p==null?void 0:p.type)==="DISLIKE"?"rgba(211, 47, 47, 0.2)":"rgba(0, 0, 0, 0.04)"}},children:b?e.jsx(pe,{size:16}):e.jsx(js,{fontSize:"small"})})})]}),e.jsx(Ht,{open:!!R,autoHideDuration:6e3,onClose:E,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Ve,{onClose:E,severity:"error",sx:{width:"100%"},children:R})})]})};var ie={},Ue;function Ss(){if(Ue)return ie;Ue=1;var n=_();Object.defineProperty(ie,"__esModule",{value:!0}),ie.default=void 0;var i=n(H()),d=U();return ie.default=(0,i.default)((0,d.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy"),ie}var Cs=Ss();const Is=F(Cs);var ae={},Fe;function ks(){if(Fe)return ae;Fe=1;var n=_();Object.defineProperty(ae,"__esModule",{value:!0}),ae.default=void 0;var i=n(H()),d=U();return ae.default=(0,i.default)((0,d.jsx)("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6m6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26"}),"Autorenew"),ae}var zs=ks();const As=F(zs),Rs=()=>e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.5,py:1},children:[e.jsx(o,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"#52946B",animation:"typing 1.4s infinite ease-in-out",animationDelay:"0s","@keyframes typing":{"0%, 80%, 100%":{opacity:.3,transform:"scale(0.8)"},"40%":{opacity:1,transform:"scale(1)"}}}}),e.jsx(o,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"#52946B",animation:"typing 1.4s infinite ease-in-out",animationDelay:"0.2s","@keyframes typing":{"0%, 80%, 100%":{opacity:.3,transform:"scale(0.8)"},"40%":{opacity:1,transform:"scale(1)"}}}}),e.jsx(o,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"#52946B",animation:"typing 1.4s infinite ease-in-out",animationDelay:"0.4s","@keyframes typing":{"0%, 80%, 100%":{opacity:.3,transform:"scale(0.8)"},"40%":{opacity:1,transform:"scale(1)"}}}})]});function co(){const{id:n}=vt(),i=Ce(),[d]=bt(),h=d.get("conversationId"),[s,b]=a.useState(null),I=qe(),R=Be(I.breakpoints.down("sm")),[w,p]=a.useState(!1),[k,y]=a.useState(!1),[L,E]=a.useState(null),[v,j]=a.useState([]),[P,T]=a.useState(""),[z,q]=a.useState(""),[Y,J]=a.useState(null),[N,K]=a.useState(""),[ce,G]=a.useState(!1),V=a.useRef(null),[de,Q]=a.useState(""),[S,Z]=a.useState(null),[me,ge]=a.useState(!1),[x,f]=a.useState(!0),[u,W]=a.useState(!0),[X,xe]=a.useState([]);a.useEffect(()=>{const t=setTimeout(()=>W(!1),7e3);return()=>clearTimeout(t)},[]);const B=a.useCallback(async()=>{try{const t=await Ke(),r=t.data.filter(l=>l.personaId===(s==null?void 0:s.id));if(console.log("Current persona ID:",s==null?void 0:s.id),console.log("All conversations:",t.data.map(l=>{var c;return{id:l.id,personaId:l.personaId,persona:l.persona,personaName:(c=l.persona)==null?void 0:c.name}})),console.log("Persona conversations:",r.map(l=>{var c;return{id:l.id,personaId:l.personaId,persona:l.persona,personaName:(c=l.persona)==null?void 0:c.name}})),h)if(/^[a-z0-9]{25}$/.test(h)){let c=r.find(m=>m.id===h);if(!c&&(c=t.data.find(m=>m.id===h),c)){console.log("Found conversation in all conversations, but it belongs to persona:",c.personaId);try{const m=await De(c.personaId);b(m);return}catch(m){console.error("Error loading correct persona:",m)}}if(c){q(h),Z(c);try{const m=d.get("sessionId");if(m){const A=await _t(m);ve({...c,messages:A.messages})}else ve(c)}catch{ve(c)}console.log("Loaded existing conversation from URL:",c.id)}else{console.warn("Conversation not found in any conversations:",h);const m=new URL(window.location.href);m.searchParams.delete("conversationId"),window.history.replaceState({},"",m.toString())}}else{console.warn("Invalid conversation ID in URL:",h);const c=new URL(window.location.href);c.searchParams.delete("conversationId"),window.history.replaceState({},"",c.toString())}else if(z){const l=r.find(c=>c.id===z);l&&Z(l)}}catch(t){console.error("Error loading conversations:",t)}},[s==null?void 0:s.id,h,z,d]);a.useEffect(()=>{s!=null&&s.id&&B()},[s==null?void 0:s.id,h,B]),a.useEffect(()=>{h&&(s!=null&&s.id)&&(console.log("Conversation ID from URL detected:",h),B())},[h,s==null?void 0:s.id,B]);const ve=t=>{if(!t.messages||!Array.isArray(t.messages)){console.warn("No messages found in conversation:",t.id),j([]);return}const r=t.messages.map(l=>({sender:l.role==="USER"?"user":"ai",text:l.content,id:l.id,edited:l.edited||!1,reactions:l.reactions||[]}));j(r)};a.useEffect(()=>{async function t(){try{const r=await Ne();xe(r.data||[])}catch(r){console.error("Error fetching personas from backend:",r),xe([])}}t()},[]),a.useEffect(()=>{try{const t=JSON.parse(localStorage.getItem("user")||"{}");Q(t.avatar||"")}catch{}},[]),a.useEffect(()=>{async function t(){if(f(!0),n)try{const r=await De(n);b(r)}catch(r){console.error("Error fetching persona from backend:",r)}finally{f(!1)}else f(!1)}t()},[n]);const Xe=(t,r)=>{if(r==="1")return["Analyze payment gateway performance","Review transaction failure rates","Optimize checkout conversion rates","Check payment processing costs","Evaluate fraud detection metrics"];if(r==="2")return["Review product roadmap priorities","Analyze feature adoption metrics","Get user feedback insights","Check sprint progress status","Evaluate market competitive analysis"];switch(t){case"Tech":return["Ask about QR transaction flows","Get merchant risk metrics","Clarify settlement SLA"];case"Marketing":return["Request latest campaign stats","Ask for competitor analysis","Get social media insights"];case"Sales":return["Ask for sales pipeline update","Request lead conversion rates","Get monthly sales summary"];default:return["Ask a question","Request a report","Get latest updates"]}},Ye=we.useMemo(()=>s?Xe(s.department||"",s.id):[],[s]);a.useEffect(()=>{const t=()=>{V.current&&V.current.scrollTo({top:V.current.scrollHeight,behavior:"smooth"})},r=setTimeout(()=>{requestAnimationFrame(t)},100);return()=>clearTimeout(r)},[v]),a.useEffect(()=>{const t=r=>{(r.ctrlKey||r.metaKey)&&r.key.toLowerCase()==="k"&&(r.preventDefault(),console.log("Search functionality temporarily disabled"))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]);const Je=(t,r)=>{const l=v.find(c=>c.id===t);if(l){if(l.sender!=="user"){console.log("Only user messages can be edited");return}if(l.id){const c=new Date(l.id).getTime(),m=Date.now()-10*60*1e3;if(c<m){console.log("Message is too old to edit (10 minute limit)");return}}J(t),K(r)}},Qe=async t=>{if(N.trim())try{G(!0);const r=await Ut(t,N.trim());if(r.data.conversationId&&r.data.conversationId!==z){q(r.data.conversationId);const l=new URL(window.location.href);l.searchParams.set("conversationId",r.data.conversationId),window.history.replaceState({},"",l.toString())}await B(),J(null),K("")}catch(r){console.error("Error editing message:",r)}finally{G(!1)}},Ze=()=>{J(null),K("")},et=(t,r)=>{j(l=>l.map(c=>{if(c.id===t){let A=[...c.reactions||[]];return r.action==="added"?A.push({id:Date.now().toString(),type:r.type,userId:"current-user",createdAt:new Date().toISOString()}):r.action==="removed"?A=A.filter(C=>!(C.type===r.type&&C.userId==="current-user")):r.action==="updated"&&(A=A.map(C=>C.userId==="current-user"?{...C,type:r.type}:C)),{...c,reactions:A}}return c}))},tt=()=>{ge(!1)},st=(t,r)=>{if(S&&S.id===t&&Z({...S,...r}),r.archivedAt!==void 0&&r.archivedAt!==null){i(`/personas/${s==null?void 0:s.id}`);return}B()},Ie=u||x;if(!s)return e.jsxs(o,{sx:{height:"100vh",bgcolor:"#fff",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(Ae,{open:Ie,sx:{color:"#fff",zIndex:t=>t.zIndex.modal+1},children:e.jsx(pe,{color:"inherit"})}),e.jsx(g,{variant:"h6",sx:{color:"#52946B"},children:"Persona not found"})]});const ot=()=>p(!0),ke=()=>p(!1),ze=280,rt=()=>{i("/discovery")},be=()=>{y(!1),E(null)},nt=t=>{y(!1),i(`/chat/${t}`)},it=()=>{i(`/view-persona/${s.id}`)},at=async t=>{const r=(t.message||"").trim();if(!(!r||!s)){G(!0);try{const l=Date.now().toString();j(C=>[...C,{sender:"user",text:r,id:l}]),T(""),j(C=>[...C,{sender:"ai",text:"",isTyping:!0}]);const c=/^[a-z0-9]{25}$/,m=z&&c.test(z)?z:h&&c.test(h)?h:void 0;console.log("Using conversation ID:",m);const A=await Ft(s.id,r,m,t.fileId);if(!z&&A.data.conversationId){q(A.data.conversationId);const C=new URL(window.location.href);C.searchParams.set("conversationId",A.data.conversationId),window.history.replaceState({},"",C.toString())}j(C=>{const ye=[...C];return ye[ye.length-1]={sender:"ai",text:A.data.reply,id:A.data.messageId,isTyping:!1},ye}),await B()}catch(l){console.error("Error sending message:",l),j(c=>{const m=[...c];return m[m.length-1]={sender:"ai",text:"Sorry, there was an error sending your message. Please try again.",isTyping:!1},m})}finally{G(!1)}}},lt=v.filter(t=>t.sender==="user").length>0;return e.jsxs(o,{sx:{height:"100vh",bgcolor:"#fff",display:"flex",flexDirection:"column",overflow:"hidden",width:"100vw",maxWidth:"100vw"},children:[e.jsx(Ae,{open:Ie,sx:{color:"#fff",zIndex:t=>t.zIndex.modal+2},children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[e.jsx(pe,{color:"inherit"}),e.jsx(g,{sx:{fontWeight:600},children:"Loading chat..."})]})}),e.jsx(ps,{onBack:rt,onMenu:ot,isSidebarOpen:w,backIcon:e.jsx(es,{sx:{fontSize:{xs:24,sm:28},color:"#012A1F"}})}),e.jsxs(o,{sx:{display:"flex",flexDirection:"row",flex:1,overflow:"hidden",width:"100%",maxWidth:"100vw",position:"relative"},children:[w&&R&&e.jsx(o,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0, 0, 0, 0.5)",zIndex:1199,transition:"opacity 0.3s ease"},onClick:ke}),e.jsx(o,{sx:{position:"fixed",top:0,left:0,height:"100vh",zIndex:1200,transform:w?"translateX(0)":"translateX(-100%)",transition:"transform 0.3s cubic-bezier(.4,0,.2,1)"},children:e.jsx(us,{onClose:ke,currentPersonaId:s.id,onSearchChats:()=>{}})}),e.jsxs(o,{sx:{flex:1,display:"flex",flexDirection:"column",position:"relative",transition:"margin-left 0.3s cubic-bezier(.4,0,.2,1)",ml:{xs:0,md:w?`${ze}px`:0},height:"100%",width:"100%",maxWidth:"100vw",overflow:"hidden"},children:[e.jsxs(o,{ref:V,sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",maxWidth:"100vw",mx:0,overflowY:"auto",overflowX:"hidden",pb:{xs:20,sm:30},scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"},minHeight:0},children:[e.jsxs(o,{sx:{width:"100%",maxWidth:{xs:"100%",sm:900},mx:"auto",mb:2,display:"flex",flexDirection:"column",gap:2,px:{xs:2,sm:0},overflow:"visible"},children:[e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:{xs:2,sm:3},px:{xs:2,sm:0},pt:{xs:2,sm:3},pb:{xs:1,sm:2},position:"relative"},children:[e.jsx($,{src:s.avatarUrl||s.avatar||"",sx:{width:{xs:80,sm:96},height:{xs:80,sm:96},mb:{xs:1.5,sm:2},cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"scale(1.05)"}},onClick:it,onError:t=>{console.error("Avatar image failed to load:",s.avatarUrl||s.avatar),console.error("Error event:",t)},onLoad:()=>{}}),e.jsxs(g,{variant:"h5",sx:{fontWeight:600,color:"#222",mb:.5,fontSize:{xs:"20px",sm:"24px"},textAlign:"center"},children:[s.name,s.isAvailable===!1&&e.jsx(o,{component:"span",sx:{ml:1,px:1,py:.5,bgcolor:"#ffebee",color:"#c62828",fontSize:"12px",borderRadius:1,fontWeight:500},children:"Temporarily Unavailable"})]}),e.jsx(g,{variant:"subtitle1",sx:{color:"#2950DA",fontWeight:400,fontSize:{xs:16,sm:18},textAlign:"center"},children:s.role}),s.department&&e.jsx(g,{variant:"body2",sx:{color:"#666",fontWeight:400,fontSize:{xs:14,sm:16},textAlign:"center",mt:.5},children:s.department}),s.description&&e.jsx(g,{variant:"body2",sx:{color:"#888",fontWeight:400,fontSize:{xs:13,sm:15},textAlign:"center",mt:.5},children:s.description}),e.jsx(o,{sx:{display:"flex",justifyContent:"center",mt:1},children:e.jsx(As,{onClick:()=>y(!0),sx:{ml:1,color:"#2950DA",fontSize:32,cursor:"pointer",borderRadius:"50%",transition:"background 0.2s","&:hover":{background:"#e8f5e9"}}})}),e.jsxs($e,{open:k,onClose:be,maxWidth:"xs",fullWidth:!0,children:[e.jsx(Wt,{sx:{fontWeight:600,fontSize:22,color:"#222",textAlign:"center"},children:"Switch Persona"}),e.jsxs(Dt,{sx:{p:3},children:[X.filter(t=>t.id!==s.id).map(t=>e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:2,cursor:"pointer",borderRadius:2,p:1.2,"&:hover":{background:"#f5f5f5"}},onClick:()=>nt(t.id),children:[e.jsx($,{src:t.avatar,sx:{width:48,height:48}}),e.jsxs(o,{children:[e.jsxs(g,{sx:{fontWeight:600,fontSize:18,color:"#222"},children:[t.name,t.isAvailable===!1&&e.jsx(o,{component:"span",sx:{ml:1,px:1,py:.5,bgcolor:"#ffebee",color:"#c62828",fontSize:"10px",borderRadius:1,fontWeight:500},children:"Unavailable"})]}),e.jsx(g,{sx:{color:"#2950DA",fontSize:16},children:t.role})]})]},t.id)),X.filter(t=>t.id!==s.id).length===0&&e.jsx(g,{sx:{color:"#888",textAlign:"center",mt:2},children:"No other personas available."})]}),e.jsx(Lt,{sx:{justifyContent:"center",pb:2},children:e.jsx(le,{onClick:be,variant:"outlined",color:"primary",children:"Cancel"})})]})]}),v.map((t,r)=>t.sender==="ai"?e.jsx(o,{"data-msg-idx":r,sx:{width:"100%",display:"flex",justifyContent:"flex-start",mb:2},children:e.jsxs(o,{sx:{display:"flex",flexDirection:"row",alignItems:"flex-end",gap:2},children:[e.jsx($,{sx:{width:42,height:42,mb:.5},children:e.jsx("img",{src:s.avatarUrl||s.avatar||"",alt:"AI",style:{width:48,height:48,borderRadius:"50%"}})}),e.jsxs(o,{children:[e.jsx(o,{sx:{color:"#52946B",fontWeight:500,fontSize:16,mb:1},children:s.name}),t.isTyping?e.jsx(o,{sx:{bgcolor:"#F0F5F2",color:"#4e5357",px:{xs:2.5,sm:2},py:{xs:2,sm:2.5},borderRadius:3,fontSize:16,fontWeight:400,maxWidth:{xs:"100%",sm:600},wordBreak:"break-word",boxShadow:"none",lineHeight:1.5,textAlign:"left",whiteSpace:"pre-wrap"},children:e.jsx(Rs,{})}):e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:1,maxWidth:{xs:"100%",sm:600}},children:[t.fileUrl&&e.jsx(o,{sx:{bgcolor:"#F0F5F2",borderRadius:3,p:1,boxShadow:"none"},children:t.fileType&&t.fileType.startsWith("image/")?e.jsx("img",{src:t.fileUrl,alt:"attachment",style:{maxWidth:250,maxHeight:250,borderRadius:8,display:"block",width:"100%",height:"auto"}}):e.jsx(o,{sx:{width:20,height:20,bgcolor:"#4e5357",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},onClick:()=>window.open(t.fileUrl,"_blank"),children:e.jsx(o,{sx:{width:12,height:12,bgcolor:"#fff",borderRadius:.5}})})}),t.text&&e.jsxs(e.Fragment,{children:[e.jsx(o,{sx:{bgcolor:"#F0F5F2",color:"#4e5357",px:{xs:2.5,sm:2},py:{xs:2,sm:2.5},borderRadius:3,fontSize:16,fontWeight:400,wordBreak:"break-word",boxShadow:"none",lineHeight:1.5,textAlign:"left",whiteSpace:"pre-wrap",maxWidth:"100%"},children:t.text.match(/(\n\s*[-*]|^\d+\.|^#)/m)?e.jsx(Nt,{content:t.text}):t.text}),e.jsx(D,{size:"small","aria-label":"Copy AI response",sx:{mt:.5,alignSelf:"flex-start",color:"#4e5357"},onClick:()=>{t.text&&navigator.clipboard.writeText(t.text)},children:e.jsx(Is,{fontSize:"small"})})]}),t.id&&e.jsx(ws,{messageId:t.id,reactions:t.reactions,currentUserId:"current-user",onReactionUpdate:et,disabled:ce||!!(S!=null&&S.archivedAt)})]})]})]})},r):e.jsx(o,{"data-msg-idx":r,sx:{width:"100%",display:"flex",justifyContent:"flex-end",mb:2,mr:{xs:0,sm:4}},children:e.jsxs(o,{sx:{display:"flex",flexDirection:"row-reverse",alignItems:"flex-end",gap:1},children:[e.jsx($,{sx:{width:42,height:42,mb:.5},children:de?e.jsx("img",{src:de,alt:"User",style:{width:48,height:48,borderRadius:"50%"}}):e.jsx("span",{style:{width:48,height:48,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:500,color:"#fff"},children:"U"})}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1,maxWidth:{xs:"100%",sm:400}},children:[t.fileUrls&&t.fileUrls.length>0&&e.jsx(o,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:1},children:t.fileUrls.map((l,c)=>e.jsx("img",{src:l,alt:`attachment-${c}`,style:{width:"3rem",height:"3rem",display:"block"}},c))}),t.fileUrl&&!t.fileUrls&&(t.fileType&&t.fileType.startsWith("image/")?e.jsx("img",{src:t.fileUrl,alt:"attachment",style:{width:"3rem",height:"3rem",display:"block"}}):e.jsx(o,{sx:{width:20,height:20,bgcolor:"#fff",borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},onClick:()=>window.open(t.fileUrl,"_blank"),children:e.jsx(o,{sx:{width:12,height:12,bgcolor:"#2950DA",borderRadius:.5}})})),t.text&&e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(o,{sx:{bgcolor:"#2950DA",color:"#fff",px:{xs:2.5,sm:3},py:{xs:2,sm:2.5},borderRadius:3,fontSize:16,fontWeight:400,wordBreak:"break-word",boxShadow:"0 2px 8px rgba(44,62,80,0.04)",lineHeight:1.5,textAlign:"start",whiteSpace:"pre-wrap",maxWidth:"100%","&:hover + .edit-button-container .edit-button":{opacity:1}},children:Y===t.id?e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(Gt,{value:N,onChange:l=>K(l.target.value),multiline:!0,fullWidth:!0,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{color:"#fff","& fieldset":{borderColor:"rgba(255,255,255,0.3)"},"&:hover fieldset":{borderColor:"rgba(255,255,255,0.5)"},"&.Mui-focused fieldset":{borderColor:"#fff"}}}}),e.jsxs(o,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(D,{size:"small",onClick:()=>Qe(t.id),sx:{color:"#fff",bgcolor:"rgba(255,255,255,0.1)"},children:e.jsx(os,{fontSize:"small"})}),e.jsx(D,{size:"small",onClick:Ze,sx:{color:"#fff",bgcolor:"rgba(255,255,255,0.1)"},children:e.jsx(jt,{fontSize:"small"})})]})]}):e.jsxs(o,{children:[t.text,t.edited&&e.jsx(g,{variant:"caption",sx:{color:"rgba(255,255,255,0.6)",fontSize:"0.75rem",ml:1},children:"(edited)"})]})}),Y!==t.id&&t.sender==="user"&&e.jsx(o,{className:"edit-button-container",sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(D,{className:"edit-button",size:"small",onClick:()=>Je(t.id,t.text),sx:{color:"#666",bgcolor:"rgba(0,0,0,0.05)",opacity:0,transition:"opacity 0.2s","&:hover":{bgcolor:"rgba(0,0,0,0.1)"}},children:e.jsx(yt,{fontSize:"small"})})})]})]})]})},r))]}),k&&L&&e.jsx(qt,{onClickAway:be,children:e.jsx(o,{sx:{position:"absolute",top:{xs:140,sm:160},left:{xs:"50%",sm:"calc(50% + 100px)"},transform:{xs:"translateX(-50%)",sm:"none"},bgcolor:"#fafbfa",borderRadius:2,boxShadow:"0 2px 8px 0 rgba(44,62,80,0.10)",p:{xs:1,sm:1.1},minWidth:{xs:200,sm:160},zIndex:30},children:e.jsx(g,{variant:"h6",sx:{color:"#888",fontWeight:600,mb:1,fontSize:{xs:14,sm:15}},children:"Switch Persona"})})})]}),e.jsxs(o,{sx:{position:"absolute",left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",pt:0,pb:{xs:2,sm:4},background:"linear-gradient(180deg, rgba(255,255,255,0) 0%, #fff 20%)"},children:[(S==null?void 0:S.archivedAt)&&e.jsx(o,{sx:{mb:2,px:2,maxWidth:960,width:"100%"},children:e.jsx(Ve,{severity:"info",sx:{borderRadius:2},children:e.jsxs(g,{variant:"body2",children:[e.jsx("strong",{children:"This conversation is archived."})," You cannot send new messages or edit existing ones. You can unarchive it from the conversation settings to continue chatting."]})})}),e.jsx(Kt,{value:P,onChange:T,onSend:at,disabled:ce||!!(S!=null&&S.archivedAt),persona:s,conversationId:z,sidebarOpen:w,sidebarWidth:ze,maxWidth:960,suggestions:Ye,showSuggestions:!lt})]})]})]}),e.jsx(Ge,{open:me,onClose:tt,conversation:S,onConversationUpdate:st})]})}export{co as default};
