import{j as u,g as R,a as j,r as v,u as N,_ as D,b as i,s as k,c as z,e as F}from"./index-DZZOxePK.js";import{c as E}from"./createSvgIcon-BIhj4CPR.js";import{u as M}from"./useSlot-CoHkQtrl.js";const U=E(u.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function B(e){return R("MuiAvatar",e)}j("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const _=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],$=e=>{const{classes:t,variant:o,colorDefault:r}=e;return F({root:["root",o,r&&"colorDefault"],img:["img"],fallback:["fallback"]},B,t)},L=k("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[o.variant],o.colorDefault&&t.colorDefault]}})(({theme:e})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(e.vars||e).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:i({color:(e.vars||e).palette.background.default},e.vars?{backgroundColor:e.vars.palette.Avatar.defaultBg}:i({backgroundColor:e.palette.grey[400]},e.applyStyles("dark",{backgroundColor:e.palette.grey[600]})))}]})),O=k("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(e,t)=>t.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),q=k(U,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(e,t)=>t.fallback})({width:"75%",height:"75%"});function J({crossOrigin:e,referrerPolicy:t,src:o,srcSet:r}){const[a,s]=v.useState(!1);return v.useEffect(()=>{if(!o&&!r)return;s(!1);let l=!0;const n=new Image;return n.onload=()=>{l&&s("loaded")},n.onerror=()=>{l&&s("error")},n.crossOrigin=e,n.referrerPolicy=t,n.src=o,r&&(n.srcset=r),()=>{l=!1}},[e,t,o,r]),a}const K=v.forwardRef(function(t,o){const r=N({props:t,name:"MuiAvatar"}),{alt:a,children:s,className:l,component:n="div",slots:c={},slotProps:p={},imgProps:w,sizes:I,src:g,srcSet:h,variant:S="circular"}=r,A=D(r,_);let d=null;const T=J(i({},w,{src:g,srcSet:h})),y=g||h,x=y&&T!=="error",f=i({},r,{colorDefault:!x,component:n,variant:S}),m=$(f),[P,C]=M("img",{className:m.img,elementType:O,externalForwardedProps:{slots:c,slotProps:{img:i({},w,p.img)}},additionalProps:{alt:a,src:g,srcSet:h,sizes:I},ownerState:f});return x?d=u.jsx(P,i({},C)):s||s===0?d=s:y&&a?d=a[0]:d=u.jsx(q,{ownerState:f,className:m.fallback}),u.jsx(L,i({as:n,ownerState:f,className:z(m.root,l),ref:o},A,{children:d}))});async function b(){const e="http://localhost:3000",t=localStorage.getItem("refreshToken");if(!t)throw new Error("No refresh token available");const o=await fetch(`${e}/api/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(!o.ok)throw new Error("Failed to refresh token");const r=await o.json();if(r.data&&r.data.accessToken)return localStorage.setItem("token",r.data.accessToken),r.data.refreshToken&&localStorage.setItem("refreshToken",r.data.refreshToken),r.data.accessToken;throw new Error("No token returned")}async function Q(e,t={}){let o=localStorage.getItem("token");const r=localStorage.getItem("workspaceId");let a={...t.headers||{},Authorization:`Bearer ${o}`};r&&(a["x-workspace-id"]=r);let s=await fetch(e,{...t,headers:a});if(s.status===401)try{o=await b(),a={...a||{},Authorization:`Bearer ${o}`},r&&(a["x-workspace-id"]=r),s=await fetch(e,{...t,headers:a})}catch(l){throw localStorage.removeItem("token"),window.location.href="/login",l}if(s.status===500)try{const n=await s.clone().text(),c=JSON.parse(n);if(c.error&&c.error.message&&(c.error.message.includes("Invalid or expired access token")||c.error.message.includes("Invalid or expired token")))try{o=await b(),a={...a||{},Authorization:`Bearer ${o}`},r&&(a["x-workspace-id"]=r),s=await fetch(e,{...t,headers:a})}catch(p){throw localStorage.removeItem("token"),window.location.href="/login",p}}catch(l){console.warn("Could not parse error response:",l)}return s}export{K as A,Q as f};
