import{f as S,h as w,i as I,r as l,R as ae,j as e,B as r,T as o,C as ie,n as se}from"./index-5_xlyy_z.js";import{E as le}from"./Edit-DX_2lBKN.js";import{P as q}from"./PhotoCamera-DK_7yHhm.js";import{r as O}from"./createSvgIcon-BNamIVrA.js";import{f as h}from"./session-Cma3K_fR.js";import{A as H,D as ce}from"./AdminSidebar-ir24IhBt.js";import{g as de}from"./avatarService-BCG4JWCu.js";import{I as M}from"./IconButton-gBT5SOuH.js";import{P as f}from"./Paper-BlKRAiFO.js";import{A as ue}from"./Avatar-CgNGEcCC.js";import{B as x}from"./Button-D0cPLAFR.js";import{D as fe,a as xe,b as he,c as me}from"./DialogTitle-Bj6VsLFW.js";import{T as ge}from"./TextField-DTeEVDZd.js";import"./createSvgIcon-yTDobCCO.js";import"./useControlled-l9-LdqaY.js";import"./Menu-V8Z48i-c.js";import"./resolveComponentProps-DW3eJbQO.js";import"./useMediaQuery-Cnns6WQt.js";import"./getThemeProps-1gZypGI7.js";import"./Divider-BNw4ekCJ.js";import"./useSlot-D9lDOFSj.js";var m={},L;function pe(){if(L)return m;L=1;var t=S();Object.defineProperty(m,"__esModule",{value:!0}),m.default=void 0;var i=t(O()),s=w();return m.default=(0,i.default)((0,s.jsx)("path",{d:"M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2zm-2 0-8 5-8-5zm0 12H4V8l8 5 8-5z"}),"EmailOutlined"),m}var je=pe();const ve=I(je);var g={},J;function be(){if(J)return g;J=1;var t=S();Object.defineProperty(g,"__esModule",{value:!0}),g.default=void 0;var i=t(O()),s=w();return g.default=(0,i.default)((0,s.jsx)("path",{d:"M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79zm9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75zM7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1"}),"PhoneOutlined"),g}var ye=be();const Se=I(ye);var p={},B;function we(){if(B)return p;B=1;var t=S();Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var i=t(O()),s=w();return p.default=(0,i.default)((0,s.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7-.25c.22 0 .41.1.55.25.12.13.2.31.2.5 0 .41-.34.75-.75.75s-.75-.34-.75-.75c0-.19.08-.37.2-.5.14-.15.33-.25.55-.25M19 19H5V5h14zM12 6c-1.65 0-3 1.35-3 3s1.35 3 3 3 3-1.35 3-3-1.35-3-3-3m0 4c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-6 6.47V18h12v-1.53c0-2.5-3.97-3.58-6-3.58s-6 1.07-6 3.58M8.31 16c.69-.56 2.38-1.12 3.69-1.12s3.01.56 3.69 1.12z"}),"AssignmentIndOutlined"),p}var Ie=we();const Oe=I(Ie);var j={},V;function Ce(){if(V)return j;V=1;var t=S();Object.defineProperty(j,"__esModule",{value:!0}),j.default=void 0;var i=t(O()),s=w();return j.default=(0,i.default)((0,s.jsx)("path",{d:"m17 8-1.41 1.41L17.17 11H9v2h8.17l-1.58 1.58L17 16l4-4zM5 5h7V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h7v-2H5z"}),"LogoutOutlined"),j}var Pe=Ce();const Re=I(Pe),Ke=()=>{const[t,i]=l.useState(null),[s,U]=l.useState(!0),[v,E]=l.useState(""),[$,b]=l.useState(!1),[u,C]=l.useState(""),[P,W]=l.useState(!1),[R,N]=l.useState(!1),[y,z]=l.useState(null),[G,k]=l.useState(null),F=ae.useRef(null),T=JSON.parse(localStorage.getItem("user")||"{}");l.useEffect(()=>{(async()=>{U(!0),E("");try{const c=await h("http://localhost:3000/api/users/me");if(!c.ok)throw new Error("Failed to fetch profile");const d=await c.json();i(d.data.user)}catch{E("Failed to load profile")}finally{U(!1)}})()},[]);const A=()=>{se()},Y=()=>{C((t==null?void 0:t.name)||""),b(!0)},K=async()=>{if(u.trim()){W(!0);try{if(!(await h("http://localhost:3000/api/users/me",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u.trim()})})).ok)throw new Error("Failed to update name");i({...t,name:u.trim()});const d={...JSON.parse(localStorage.getItem("user")||"{}"),name:u.trim()};localStorage.setItem("user",JSON.stringify(d)),b(!1),C("")}catch{alert("Failed to update name. Please try again.")}finally{W(!1)}}},Q=async()=>{if(window.confirm("Are you sure you want to deactivate your account? This action cannot be undone."))try{if(!(await h("http://localhost:3000/api/auth/deactivate",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to deactivate account");localStorage.clear(),window.location.href="/login"}catch{alert("Failed to deactivate account. Please try again.")}},X=async()=>{if(window.confirm("Are you sure you want to delete your account? This action is permanent and cannot be undone. Your account will be permanently deleted in 30 days."))try{if(!(await h("http://localhost:3000/api/auth/delete-account",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete account");alert("Account deletion requested. Your account will be permanently deleted in 30 days."),localStorage.clear(),window.location.href="/login"}catch{alert("Failed to delete account. Please try again.")}},Z=n=>{var D;const a=(D=n.target.files)==null?void 0:D[0];if(!a)return;if(!["image/jpeg","image/png","image/gif","image/webp"].includes(a.type)){alert("Please select a valid image file (JPEG, PNG, GIF, or WebP)");return}const d=2*1024*1024;if(a.size>d){alert("File size too large. Maximum size is 2MB");return}z(a),k(URL.createObjectURL(a))},ee=async()=>{if(y){N(!0);try{const n="http://localhost:3000",a=new FormData;a.append("avatar",y);const c=await h(`${n}/api/users/me/avatar`,{method:"POST",body:a});if(!c.ok){const oe=await c.json();throw new Error(oe.error||"Failed to upload avatar")}const d=await c.json();i({...t,avatarUrl:d.data.avatarUrl});const ne={...JSON.parse(localStorage.getItem("user")||"{}"),avatar:d.data.avatarUrl};localStorage.setItem("user",JSON.stringify(ne)),k(null),z(null),alert("Avatar uploaded successfully!")}catch(n){alert(n instanceof Error?n.message:"Failed to upload avatar. Please try again.")}finally{N(!1)}}},te=()=>{var n;(n=F.current)==null||n.click()},[re,_]=l.useState(!1);return e.jsxs(r,{sx:{display:"flex",minHeight:"100vh",bgcolor:"#f7f8fa"},children:[e.jsx(r,{sx:{display:{xs:"none",md:"block"}},children:e.jsx(H,{userRole:T.role,currentTab:"profile",onSignOut:A})}),e.jsx(ce,{open:re,onClose:()=>_(!1),PaperProps:{sx:{width:240}},children:e.jsx(H,{userRole:T.role,currentTab:"profile",onSignOut:A,isDrawer:!0})}),e.jsxs(r,{sx:{flex:1,display:"flex",flexDirection:"column",ml:{xs:0,md:"220px"}},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,bgcolor:"#fff",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[e.jsx(o,{variant:"h5",sx:{fontWeight:700,color:"#222"},children:"Profile"}),e.jsx(M,{onClick:()=>_(!0),children:e.jsx(q,{sx:{color:"#2950DA",fontSize:28}})})]}),e.jsxs(r,{sx:{flex:1,px:{xs:2,md:6},py:{xs:2,md:4}},children:[e.jsx(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(o,{variant:"h4",sx:{fontWeight:700,color:"#222"},children:"Profile"})}),s?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"40vh"},children:e.jsx(o,{children:"Loading profile..."})}):v?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"40vh"},children:e.jsx(o,{color:"error",children:v})}):null]}),!s&&!v&&e.jsx(f,{elevation:0,sx:{borderRadius:3,p:0,mb:4,overflow:"hidden",bgcolor:"#f2f7f3"},children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:5,position:"relative",minHeight:220},children:[e.jsxs(r,{sx:{position:"relative",width:140,height:140,mb:2},children:[e.jsx(ue,{src:G||de(t==null?void 0:t.avatarUrl),sx:{width:140,height:140,bgcolor:"#e6e6e6",fontSize:80},children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{cx:"12",cy:"8",r:"4",stroke:"#222",strokeWidth:"2"}),e.jsx("path",{d:"M4 20c0-4 4-7 8-7s8 3 8 7",stroke:"#222",strokeWidth:"2"})]})}),e.jsx(r,{onClick:te,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",bgcolor:"rgba(0,0,0,0.15)",borderRadius:"50%",transition:"background 0.2s","&:hover":{bgcolor:"rgba(0,0,0,0.25)"}},children:e.jsx(q,{sx:{color:"#fff",fontSize:32}})})]}),y&&e.jsxs(r,{sx:{mb:2,display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[e.jsxs(o,{sx:{color:"#666",fontSize:14},children:["Selected: ",y.name]}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(x,{variant:"contained",size:"small",disabled:R,onClick:ee,sx:{bgcolor:"#2950DA",color:"#fff","&:hover":{bgcolor:"#526794"},"&:disabled":{bgcolor:"#ccc"}},children:R?e.jsxs(e.Fragment,{children:[e.jsx(ie,{size:16,sx:{color:"#fff",mr:1}}),"Uploading..."]}):"Upload Avatar"}),e.jsx(x,{variant:"outlined",size:"small",disabled:R,onClick:()=>{z(null),k(null)},sx:{borderColor:"#666",color:"#666","&:hover":{borderColor:"#333",color:"#333"}},children:"Cancel"})]})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[e.jsx(o,{sx:{fontWeight:700,fontSize:22,color:"#222"},children:(t==null?void 0:t.name)||"N/A"}),e.jsx(M,{onClick:Y,sx:{p:.5,color:"#2950DA","&:hover":{bgcolor:"rgba(41, 80, 218, 0.08)"}},children:e.jsx(le,{sx:{fontSize:20}})})]}),e.jsx(o,{sx:{color:"#888",fontWeight:600,fontSize:17,mb:2},children:(t==null?void 0:t.role)||"User"})]})}),!s&&!v&&e.jsxs(r,{sx:{maxWidth:600,mx:"auto",display:"flex",flexDirection:"column",gap:2,px:{xs:2,md:0}},children:[e.jsxs(f,{elevation:0,sx:{borderRadius:2,p:0,display:"flex",alignItems:"center",minHeight:64},children:[e.jsx(r,{sx:{width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f2f7f3",borderRadius:2},children:e.jsx(ve,{sx:{fontSize:32,color:"#888"}})}),e.jsxs(r,{sx:{flex:1,pl:2},children:[e.jsx(o,{sx:{color:"#888",fontWeight:600,fontSize:16},children:"Email"}),e.jsx(o,{sx:{color:"#222",fontWeight:700,fontSize:17},children:(t==null?void 0:t.email)||"N/A"})]})]}),e.jsxs(f,{elevation:0,sx:{borderRadius:2,p:0,display:"flex",alignItems:"center",minHeight:64},children:[e.jsx(r,{sx:{width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f2f7f3",borderRadius:2},children:e.jsx(Se,{sx:{fontSize:32,color:"#888"}})}),e.jsxs(r,{sx:{flex:1,pl:2},children:[e.jsx(o,{sx:{color:"#888",fontWeight:600,fontSize:16},children:"Phone No."}),e.jsx(o,{sx:{color:"#222",fontWeight:700,fontSize:17},children:(t==null?void 0:t.phone)||"N/A"})]})]}),e.jsxs(f,{elevation:0,sx:{borderRadius:2,p:0,display:"flex",alignItems:"center",minHeight:64},children:[e.jsx(r,{sx:{width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f2f7f3",borderRadius:2},children:e.jsx(Oe,{sx:{fontSize:32,color:"#888"}})}),e.jsxs(r,{sx:{flex:1,pl:2},children:[e.jsx(o,{sx:{color:"#888",fontWeight:600,fontSize:16},children:"Admin Id"}),e.jsx(o,{sx:{color:"#222",fontWeight:700,fontSize:17},children:(t==null?void 0:t.id)||"N/A"})]})]}),e.jsxs(f,{elevation:0,sx:{borderRadius:2,p:0,display:"flex",alignItems:"center",minHeight:64,cursor:"pointer","&:hover":{bgcolor:"#f7f8fa"}},onClick:A,children:[e.jsx(r,{sx:{width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#f2f7f3",borderRadius:2},children:e.jsx(Re,{sx:{fontSize:32,color:"#888"}})}),e.jsx(r,{sx:{flex:1,pl:2},children:e.jsx(o,{sx:{color:"#222",fontWeight:700,fontSize:17},children:"Log out"})})]}),e.jsxs(f,{elevation:0,sx:{borderRadius:2,p:0,mt:2,display:"flex",alignItems:"center",minHeight:64,background:"none",boxShadow:"none"},children:[e.jsx(r,{sx:{width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center",background:"none",borderRadius:2}}),e.jsxs(r,{sx:{flex:1,pl:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(x,{variant:"contained",sx:{bgcolor:"#526794",color:"#fff",fontWeight:700,borderRadius:2,textTransform:"none",fontSize:16,py:1.5,height:56,boxShadow:"0 2px 8px 0 rgba(44,62,80,0.04)",flex:1,"&:hover":{bgcolor:"#526794"}},onClick:Q,children:"Deactivate Account"}),e.jsx(x,{variant:"contained",sx:{bgcolor:"#dc3545",color:"#fff",fontWeight:700,borderRadius:2,textTransform:"none",fontSize:16,py:1.5,height:56,boxShadow:"0 2px 8px 0 rgba(44,62,80,0.04)",flex:1,"&:hover":{bgcolor:"#c82333"}},onClick:X,children:"Delete Account"})]})]})]})]}),e.jsxs(fe,{open:$,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(xe,{sx:{fontWeight:700,color:"#222"},children:"Edit Name"}),e.jsx(he,{children:e.jsx(ge,{autoFocus:!0,margin:"dense",label:"Name",type:"text",fullWidth:!0,value:u,onChange:n=>C(n.target.value),sx:{mt:1}})}),e.jsxs(me,{children:[e.jsx(x,{onClick:()=>b(!1),disabled:P,sx:{color:"#666"},children:"Cancel"}),e.jsx(x,{onClick:K,variant:"contained",disabled:P||!u.trim(),sx:{bgcolor:"#2950DA","&:hover":{bgcolor:"#526794"}},children:P?"Saving...":"Save"})]})]}),e.jsx("input",{type:"file",ref:F,onChange:Z,accept:"image/jpeg,image/png,image/gif,image/webp",style:{display:"none"}})]})};export{Ke as default};
