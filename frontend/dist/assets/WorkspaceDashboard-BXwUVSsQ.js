import{r as d,j as e,B as f,T as s}from"./index-5_xlyy_z.js";import{A as I,D as T}from"./AdminSidebar-ir24IhBt.js";import{f as M}from"./session-Cma3K_fR.js";import{g as B,a as k}from"./workspaceService-W5-pIJdk.js";import{g as u}from"./avatarService-BCG4JWCu.js";import{A as C}from"./Avatar-CgNGEcCC.js";import{B as P}from"./Button-D0cPLAFR.js";import{P as D}from"./Paper-BlKRAiFO.js";import"./useControlled-l9-LdqaY.js";import"./Menu-V8Z48i-c.js";import"./resolveComponentProps-DW3eJbQO.js";import"./createSvgIcon-BNamIVrA.js";import"./createSvgIcon-yTDobCCO.js";import"./useMediaQuery-Cnns6WQt.js";import"./getThemeProps-1gZypGI7.js";import"./Divider-BNw4ekCJ.js";import"./IconButton-gBT5SOuH.js";import"./useSlot-D9lDOFSj.js";const te=({workspaceId:x,workspaceName:p,user:l,stats:g,onUsePersona:w,onSignOut:S})=>{const[b,E]=d.useState({members:(g==null?void 0:g.members)??"0",users:(g==null?void 0:g.users)??"0"}),[v,j]=d.useState(!1),[A,U]=d.useState(p),[a,y]=d.useState(l),[N,R]=d.useState(!1);d.useEffect(()=>{const c=localStorage.getItem("workspaceName");c&&c.includes("Test Workspace")&&(localStorage.removeItem("workspaceName"),console.log("Cleared test workspace name from localStorage on mount"));const i=localStorage.getItem("user");if(i)try{const t=JSON.parse(i);t.name&&t.name.includes("Test User")&&(localStorage.removeItem("user"),console.log("Cleared test user data from localStorage on mount"))}catch(t){console.warn("Error parsing user data from localStorage:",t)}U(p),console.log("Set workspace name to original prop value:",p)},[p]);const W=async()=>{var c,i,t;j(!0);try{const r=await B(),[n,m]=await Promise.all([k(r.id,{page:1,limit:1}),k(r.id,{role:"MEMBER",page:1,limit:1})]),o=(((c=n.pagination)==null?void 0:c.total)??((i=n.data)==null?void 0:i.length)??0).toString(),h=(((t=m.pagination)==null?void 0:t.total)??0).toString();E({users:o,members:h})}catch(r){console.warn("Error fetching workspace stats:",r)}finally{j(!1)}};return d.useEffect(()=>{const c=()=>{const r=localStorage.getItem("workspaceName");r&&r.includes("Test Workspace")&&(localStorage.removeItem("workspaceName"),console.log("Cleared test workspace name from localStorage")),U(p)},i=()=>{try{const r=JSON.parse(localStorage.getItem("user")||"{}"),n={name:r.name||l.name||"Demo User",role:r.role||l.role||"Member",avatarUrl:r.avatar||l.avatarUrl||""};y(n)}catch(r){console.warn("Error parsing user data from localStorage:",r)}},t=async()=>{try{const n=await M("http://localhost:3000/api/users/me");if(n.ok){const m=await n.json();if(m.status==="success"&&m.data&&m.data.user){const o=m.data.user,h={name:o.name||l.name||"Demo User",role:o.role||l.role||"Member",avatarUrl:o.avatarUrl||l.avatarUrl||""};y(h);const z={...JSON.parse(localStorage.getItem("user")||"{}"),name:o.name,role:o.role,avatarUrl:o.avatarUrl};localStorage.setItem("user",JSON.stringify(z))}}}catch(r){console.warn("Error fetching user data from API:",r)}};if(x&&x!=="demo-workspace"){W(),c(),i(),t();const r=setInterval(W,1e4),n=setInterval(c,15e3),m=setInterval(i,15e3),o=setInterval(t,3e4);return()=>{clearInterval(r),clearInterval(n),clearInterval(m),clearInterval(o)}}},[x,p,l]),e.jsxs(f,{sx:{display:"flex",minHeight:"100vh",bgcolor:"#f8f9fa"},children:[e.jsx(f,{sx:{display:{xs:"none",md:"block"}},children:e.jsx(I,{userRole:a.role,currentTab:"workspace",onSignOut:S,userName:a.name,avatarUrl:u(a.avatarUrl)})}),e.jsx(T,{open:N,onClose:()=>R(!1),PaperProps:{sx:{width:240}},children:e.jsx(I,{userRole:a.role,currentTab:"workspace",onSignOut:S,isDrawer:!0,userName:a.name,avatarUrl:u(a.avatarUrl)})}),e.jsx(f,{sx:{flex:1,display:"flex",flexDirection:"column",ml:{xs:0,md:"220px"}},children:e.jsxs(f,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(f,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:e.jsx(s,{variant:"h3",sx:{fontWeight:800,color:"#111",textAlign:"center"},children:`Welcome to ${A}`})}),e.jsx(s,{sx:{color:"#6b7280",fontWeight:500,fontSize:18,mb:4,textAlign:"center"},children:"Bring your team in and start deploying AI personas."}),e.jsx(C,{src:u(a.avatarUrl),alt:a.name,sx:{width:80,height:80,mb:1.5}}),e.jsx(f,{sx:{display:"flex",alignItems:"center",gap:2,mb:0},children:e.jsx(s,{sx:{fontWeight:700,fontSize:20,color:"#222"},children:a.name})}),e.jsx(s,{sx:{color:"#6b7280",fontWeight:500,fontSize:16,mb:3},children:a.role}),e.jsx(f,{sx:{display:"flex",gap:2,mb:5},children:e.jsx(P,{variant:"outlined",sx:{color:"#222",fontWeight:700,px:4,textTransform:"none",borderRadius:2,bgcolor:"#f3f6f4",borderColor:"#e0e0e0"},onClick:w,children:"Use Persona"})}),e.jsxs(f,{sx:{display:"flex",gap:3,mt:2},children:[e.jsxs(D,{sx:{p:3,minWidth:180,borderRadius:3,bgcolor:"#f3f6f4",position:"relative"},children:[e.jsx(s,{sx:{color:"#6b7280",fontWeight:500,fontSize:15,mb:1},children:"Members"}),e.jsx(s,{sx:{fontWeight:800,fontSize:24,color:"#111"},children:v?"...":b.members}),e.jsx(s,{sx:{color:"#9ca3af",fontWeight:400,fontSize:12,mt:.5},children:"MEMBER users only"})]}),e.jsxs(D,{sx:{p:3,minWidth:180,borderRadius:3,bgcolor:"#f3f6f4",position:"relative"},children:[e.jsx(s,{sx:{color:"#6b7280",fontWeight:500,fontSize:15,mb:1},children:"Total Users"}),e.jsx(s,{sx:{fontWeight:800,fontSize:24,color:"#111"},children:v?"...":b.users}),e.jsx(s,{sx:{color:"#9ca3af",fontWeight:400,fontSize:12,mt:.5},children:"All users"})]})]})]})})]})};export{te as default};
